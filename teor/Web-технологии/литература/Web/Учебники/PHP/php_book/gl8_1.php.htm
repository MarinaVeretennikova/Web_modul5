<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Сессии в PHP (cookies, сессии)</title>
</head>
<body bottommargin="0" marginheight="0" marginwidth="0" rightmargin="0" leftmargin="0" topmargin="0">
<table style="border-bottom-style: solid; border-width: 4px; border-color: #BABABA" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#D8F0FB">
    <tr valign="top">
        <td style="padding-left: 50" height="18" colspan="2">
            <a href="http://www.softtime.ru/" title="IT-студия SoftTime"><img src="images/softtime.gif" tppabs="http://site/bookphp/images/softtime.gif" border="0" width="137" height="18" vspace="10"></a>                    
        </td>
        <td valign="middle" align="right">  
            <a style="color: #607683; font-size: 11px; font-family: Arial, Helvetica, sans-serif;" href="mailto:softtime@softtime.ru">Написать письмо авторам</a>
        </td>
        <td width=10%>&nbsp;</td>
    </tr>
</table>
<table border="0" cellspacing="17" >
    <tr valign="bottom">
        <td width=7%>&nbsp;</td>
        <td width="30%" align="center"><h1 style="font-size: 36; padding-top: 20px;  margin: 0px">УЧЕБНИК&nbsp;PHP</h1></td>
        <td align="center"><img src="images/help.gif" tppabs="http://site/bookphp/images/help.gif" border="0" width="40" height="25" alt=""><br>
            <a class=a1 href="http://www.softtime.ru/bookphp/help.php"  title="Справочник функций языка PHP 4 на сайте IT-студии <SoftTime>"><b>справочник&nbsp;функций&nbsp;<Оnline></b></a>
        </td>
        <td align="center"><img src="images/aboutbook.gif" tppabs="http://site/bookphp/images/aboutbook.gif" border="0" width="25" height="25" alt=""><br>
            <a title="Об учебнике и его авторах" class=a1 href="aboutbook.php.htm" tppabs="http://site/bookphp/aboutbook.php"><b>Об&nbsp;учебнике</b></a>
        </td>
        <td align="center"><img src="images/updatebook.gif" tppabs="http://site/bookphp/images/updatebook.gif" border="0" width="40" height="25" alt=""><br>
            <a target="_blank" title="Проверить обновления учебника" class=a1 href="http://www.softtime.ru/info/bookphp.php"><b>Обновление</b></a>
        </td>       
    </tr>
</table><br>
<a name="up"></a>
<table border="0" cellspacing="0" cellpadding="0">
    <tr valign="top">
        <td width="25%">
            <table border="0" width="100%">
                <tr>
                    <td style="background-image: url(images/linebook1.gif); background-repeat: no-repeat"  height="5" width="213"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
                </tr>
                <tr align="left">
                    <td><p style="color: #1020E3; font-size: 16px; margin-left: 10"><b>Оглавление</b></p></td>
                </tr>
                <tr>
                    <td style="background-image: url(images/linebook2.gif); background-repeat: no-repeat" height="7"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
                </tr>
                <tr>
                    <td width="213">
                        <ol>
                            <li><a class=bookmenu href="gl1_1.php.htm" tppabs="http://site/bookphp/gl1_1.php">Основы PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl2_1.php.htm" tppabs="http://site/bookphp/gl2_1.php">Операторы языка PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl3_1.php.htm" tppabs="http://site/bookphp/gl3_1.php">Строковые функции</a></li>
                                    
                            <li><a class=bookmenu href="gl4_1.php.htm" tppabs="http://site/bookphp/gl4_1.php">Массивы</a>
                                
                            </li>                                                           
                            <li><a class=bookmenu href="gl5_1.php.htm" tppabs="http://site/bookphp/gl5_1.php">Функции</a>
                                                        </li>
                            <li><a class=bookmenu href="gl6_1.php.htm" tppabs="http://site/bookphp/gl6_1.php">Работа с файлами</a>
                                                        </li>
                            <li ><a class=bookmenu href="gl7_1.php.htm" tppabs="http://site/bookphp/gl7_1.php">Регулярные выражения</a>
                                                        </li>
                            <li ><a class=bookmenu href="gl8_1.php.htm" tppabs="http://site/bookphp/gl8_1.php">Сессии и cookies в PHP</a>
                                                            <div id="activechapter">
                                    <p class=subchapter><b><a class=bookmenu href="gl8_1.php.htm" tppabs="http://site/bookphp/gl8_1.php"><nobr>Сессии в PHP</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl8_2.php.htm" tppabs="http://site/bookphp/gl8_2.php"><nobr>Cookies</nobr></a></b></p>                                  
                                </div>
                                                        </li>
                            <li><a class=bookmenu href="gl9_1.php.htm" tppabs="http://site/bookphp/gl9_1.php">Работа с FTP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl10_1.php.htm" tppabs="http://site/bookphp/gl10_1.php">Проверка данных</a>
                                                        </li>
                            <li><a class=bookmenu href="gl11_1.php.htm" tppabs="http://site/bookphp/gl11_1.php">Гостевая книга</a>
                                                        </li>
                            <li class="newchaptr"><a class=bookmenu href="gl12_1.php.htm" tppabs="http://site/bookphp/gl12_1.php">PHP и MySQL</a>
                                                        </li>
                            
                        </ol>
                        <p><i>Продолжение следует</i></p>
                    </td>
                </tr>
            </table>
        </td>
        <td ><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<br><br>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<table border="0" cellpadding="0" cellspacing="0" height="70">
    <tr>
        <td rowspan="3" width="70"><img src="images/book.gif" tppabs="http://site/bookphp/images/book.gif" border="0" width="59" height="44" alt=""></td>
        <td height="50" valign="middle"><h1 class=namepage>Сессии и cookie в PHP</h1></td>
    </tr>
    <tr>
        <td height="7px" bgcolor="#9FB6C9"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
    </tr>
    <tr><td height="13"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td></tr>
</table><table border="0" align="right" cellpadding="0" cellspacing="7">
    <tr valign="middle" align="center">
        <td><img src="images/arrowleft.gif" tppabs="http://site/bookphp/images/arrowleft.gif" border="0" width="10" height="17" alt=""></td>
        <td><a class=a1 href="gl7_12.php.htm" tppabs="http://site/bookphp/gl7_12.php">Предыдущая</a></td>
        <td width="1" bgcolor="silver"></td>
        <td><a class=a1 href="gl8_2.php.htm" tppabs="http://site/bookphp/gl8_2.php">Следующая</a></td>
        <td><img src="images/arrowright.gif" tppabs="http://site/bookphp/images/arrowright.gif" border="0" width="10" height="17" alt=""></td>  

    </tr>
    <td colspan="5" bgcolor="silver"></td>
</table>
<h1 class=p1>Сессии (сеансы) в PHP</h1>
<table border="0" cellspacing="10">
    <tr valign="top">
        <td>
            <a class=bluelink href="#1" title="Открытие сессии" >session_start()</a>&nbsp;<br>
            <a class=bluelink href="#4" title="Разрегистрация переменных">unset()</a>&nbsp;<br>
        </td>
        <td>
            <a class=bluelink href="#2" title="Регистрация переменных сессии" >session_register()</a>&nbsp;<br>
            <a class=bluelink href="#3" title="Закрытие сессии">session_destroy()</a>&nbsp;<br>     
        </td>
        <td>        
            <a class=bluelink href="#4" title="Разрегистрация переменных">session_unregister()</a>&nbsp;<br>                    
        </td>
    </tr>
</table>
<br>
<br>

<p class=text>Сессии и cookies предназначены для хранения сведений о пользователях при переходах между несколькими страницами. При использовании сессий данные сохраняются во временных файлах на сервере. Файлы с cookies хранятся на компьютере пользователя, и по запросу отсылаются броузером серверу.</p>
<p class=text>Использование сессий и cookies очень удобно и оправдано в таких приложениях как Интернет-магазины, форумы, доски объявлений, когда, во-первых, необходимо сохранять информацию о пользователях на протяжении нескольких станиц, а, во-вторых, своевременно предоставлять пользователю новую информацию.</p>
<p class=text>Протокол HTTP является протоколом "без сохранения состояния". Это означает, что данный протокол не имеет встроенного способа сохранения состояния между двумя транзакциями. Т. е., когда пользователь открывает сначала одну страницу сайта, а затем переходит на другую страницу этого же сайта, то основываясь только на средствах, предоставляемых протоколом HTTP невозможно установить, что оба запроса относятся к одному пользователю. Т. о. необходим метод, при помощи которого было бы отслеживать информацию о пользователе в течение одного сеанса связи с Web-сайтов. Одним из таких методов является управление сеансами при помощи предназначенных для этого функций. Для нас важно то, что сеанс по сути, представляет собой группу переменных, которые, в отличие от обычных переменных, сохраняются и после завершения выполнения PHP-сценария.</p>
<p class=text>При работе с сессиями различают следующие этапы:</p>
<ul>
  <li>открытие сессии</li>
  <li>регистрация переменных сессии и их использование</li>
  <li>закрытие сессии</li>
</ul>
<a name=1></a>
<h2 class=p1>Открытие сессии</h2>
<p class=text>Самый простой способ открытия сессии заключается в использовании функции <b>session_start</b>, которая вызывается в начале PHP-сценария:</p>
<h1 class=p1>session_start</h1>
<p class=prim><b><i>Синтаксис:</i></b></p>
<blockquote><pre>
  <b>session_start</b><em class=gr>();</em>
</pre></blockquote>
<p class=text>Эта функция проверяет, существует ли идентификатор сессии, и, если нет, то создает его. Если идентификатор текущей сессии уже существует, то загружаются зарегистрированные переменные сессии.</p>
<a name=2></a>
<h2 class=p1>Регистрация переменных сессии</h2>
<p class=text>Вообще говоря, регистрация переменных сессии осуществляется при помощи функции <b>session_register</b>:</p>
<h1 class=p1>session_register</h1>
<p class=prim><b><i>Синтаксис:</i></b></p>
<blockquote><pre>
  <em class=gr>bool</em> <b>session_register</b><em class=gr>(</em><b>mixed name</b> [,<b>mixed...</b>]<em class=gr>);</em>
</pre></blockquote>
<p class=text>Т.е. для того, чтобы зарегистрировать переменную, в которой хранится имя пользователя, указанное им при регистрации, мы должны вызвать эту функцию следующим образом:</p>
<blockquote><pre>
  <b>session_register</b><em class=gr>(</em>"username"<em class=gr>);</em>
</pre></blockquote>
<p class=text>К примеру:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$name</b><em class=gr> =</em> "maksim"<em class=gr>;</em>
  <b>$maksim</b><em class=gr> =</em> "my_name"<em class=gr>;</em>
  <b>session_register</b><em class=gr>(</em><b>$name</b><em class=gr>)</em> //<em class=comnt> регистрируется переменная "maksim" со </em>
                          // <em class=comnt>значением "my_name"</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Однако, начиная с версии PHP 4.2.0, практика регистрирования сеансовых переменных претерпела некоторые изменения, что вносит в этот вопрос некоторую путаницу. Дело в том, что функция <b>session_register</b> применима только к глобальным переменным и требует, чтобы параметр <b>register_globals</b> был включен. Начиная с этой же версии языка, сеансовые переменные всегда регистрируются в ассоциативных массивах <b>$HTTP_SESSION_VARS</b> и <b>$_SESSION</b>. Т.о., аналогом вызова функции <b>session_register</b>("username") при включенном <b>register_globals</b> являются следующие выражения:</p>
<blockquote><pre>
  <b>$_SESSION</b><em class=gr>[</em>'username'<em class=gr>] =</em> "username"<em class=gr>;</em>
  //<em class=comnt> или</em>
  <b>$HTTP_SESSION_VARS</b><em class=gr>[</em>'username'<em class=gr>] = </em>"username"<em class=gr>;</em>
</pre></blockquote>
<p class=text>Такой подход является более оправданным, поскольку функция <b>session_register</b> в действительности делает то же самое - помещает значение переменной сессии в специальный массив для хранения зарегистрированных переменных сессии. Таким образом:</p>
<ul>
  <li>если вы используете функцию <b>session_register</b>, то должен быть включен параметр <b>register_globals</b></li>
  <li>при отключенном <b>register_globals</b> инициализация сеансовых переменных происходит путем присваивания значений элементам ассоциативных массивов</li>
</ul>
<p class=text>Для корректной работы приложения необходимо проверять, установлены ли переменные сессии. Такую проверку можно сделать при помощи функции <b>session_is_registered</b>:</p>
<blockquote><pre>
  <b>$result</b><em class=gr> = </em><b>session_is_registerd</b><em class=gr>(</em>"username"<em class=gr>);</em>
</pre></blockquote>
<p class=text>При использовании ассоциативных массивов <b>$HTTP_SESSION_VARS</b> и <b>$_SESSION</b> применять эту функцию не следует, а нужно напрямую проверять элементы этих массивов, к примеру, так:</p>
<blockquote><pre>
  <b>if</b><em class=gr>(</em><b>isset</b><em class=gr>(</em><b>$_SESSION</b>['username']<em class=gr>))</em>
</pre></blockquote>
<a name=3></a>
<h2 class=p1>Закрытие сессии</h2>
<p class=text>После завершения работы с сессией сначала нужно разрегистрировать все переменные сессии, а затем вызвать функцию <b>session_destroy</b>:</p>
<h1 class=p1>session_destroy</h1>
<p class=prim><b><i>Синтаксис:</i></b></p>
<blockquote><pre>
  <b>session_destroy</b><em class=gr>();</em>
</pre></blockquote>
<a name=4></a>
<p class=text>Способы разрегистрации сеансовых переменных различаются в зависимости от того, каким способом они были зарегистрированы.</p>
<p class=text>При включенном <b>register_globals</b> и использовании функции <b>session_register</b> разрегистрация осуществляется при помощи функции <b>session_unregister</b>:</p>
<h1 class=p1>session_unregister</h1>
<p class=prim><b><i>Синтаксис:</i></b></p>
<blockquote><pre>
  <b>session_unregister</b><em class=gr>(</em>"username"<em class=gr>);</em>
</pre></blockquote>
<p class=text>Если же регистрация осуществлялась путем с применением ассоциативных массивов, то поступают следующим образом:</p>
<h1 class=p1>unset</h1>
<p class=prim><b><i>Синтаксис:</i></b></p>
<blockquote><pre>
  <b>unset</b><em class=gr>(</em><b>$_SESSION</b>["username"]<em class=gr>);</em>
</pre></blockquote>
<h2 class=p1>Пример простой сессии</h2>
<p class=text>Рассмотрим пример простой сессии, работающей с тремя страницами. При посещении пользователем первой страницы открывается сессия и регистрируется переменная <b>$username</b>. Соответствующий код реализации приведен в листинге:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>session_start</b><em class=gr>();</em>
  <b>$_SESSION</b>['username']<em class=gr> = </em>"maksim"<em class=gr>;
  echo</em> 'Привет, '<b>.$_SESSION</b>['username']."&lt;br&gt;";
<em class=red>?&gt;</em>
  &lt;a href="page2.php"&gt;На следующую страницу &lt;/a&gt;
</pre></blockquote>
<p class=text>Результат работы этого сценария показан на рис:</p>
<img src="images/1.jpg" tppabs="http://site/bookphp/images/1.jpg">
<p class=text>После этого, пользователь maksim нажимает на ссылку и попадает на страницу page2.php, код которой приведен в листинге:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>session_start</b><em class=gr>();
  echo</em> <b>$_SESSION</b>['username'].' , ты пришел на другую страницу этого сайта!'<em class=gr>;
  echo(</em>"&lt;br&gt;"<em class=gr>);</em>
<em class=red>?&gt;</em>
  &lt;a href="page3.php"&gt;На следующую страницу &lt;/a&gt;
</pre></blockquote>
<p class=text>Результат работы этого скрипта показан на рис:</p>
<img src="images/2.jpg" tppabs="http://site/bookphp/images/2.jpg">
<p class=text>При нажатии на ссылку, пользователь попадает на страницу page3.php, при этом происходит разрегистрация сеансовой переменной и уничтожение сессии. Соответствующий код реализации приведен в листинге:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>session_start</b><em class=gr>();</em>
  <b>unset</b><em class=gr>(</em><b>$_SESSION</b>['username']<em class=gr>);</em> // <em class=comnt>разрегистрировали переменную</em>
  <em class=gr>echo</em> 'Привет, '<b>.$_SESSION</b>['username']<em class=gr>;</em>
  <em class=comnt>/* теперь имя пользователя уже не выводится */</em>
  <b>session_destroy</b><em class=gr>();</em> // <em class=comnt>разрушаем сессию</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Как видно из рисунка, после разрегистрации сеансовой переменной значение массива <b>$_SESSION</b>['username'] уже недоступно:</p>
<img src="images/3.jpg" tppabs="http://site/bookphp/images/3.jpg">

<br>
<br>
<table border="0" align="center" cellpadding="0" cellspacing="0">
    <tr>
        <td colspan="5" align="center"><img src="images/linebook1.gif" tppabs="http://site/bookphp/images/linebook1.gif" border="0" width="212" height="5" alt=""></td>
    </tr>
    <tr valign="middle" align="center">
        <td><img src="images/arrowleft.gif" tppabs="http://site/bookphp/images/arrowleft.gif" border="0" width="10" height="17" alt=""></td>
        <td><a class=a1 href="gl7_12.php.htm" tppabs="http://site/bookphp/gl7_12.php">Предыдущая</a></td>
        <td width="1" bgcolor="silver"></td>
        <td><a class=a1 href="gl8_2.php.htm" tppabs="http://site/bookphp/gl8_2.php">Следующая</a></td>
        <td><img src="images/arrowright.gif" tppabs="http://site/bookphp/images/arrowright.gif" border="0" width="10" height="17" alt=""></td>
    </tr>
    <tr>
        <td colspan="5" align="center"><img src="images/linebook2.gif" tppabs="http://site/bookphp/images/linebook2.gif" border="0" width="213" height="11" alt=""></td>
    </tr>
</table>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
            </p>
        </td>   
        <td width="7%">&nbsp;</td>  
    </tr>
</table>
<table border="0" width="100%">
    <tr>
        <td width=20%>&nbsp;</td>
        <td>
            <a class=a1 href="#up">Наверх</a>
        </td>
    </tr>
</table><br>
</body>
</html> 