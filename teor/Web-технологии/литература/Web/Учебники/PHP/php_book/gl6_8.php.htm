<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Работа с файлами | Работа с каталогами</title>
<link rel="StyleSheet" type="text/css" href="book4.css" tppabs="http://site/bookphp/book4.css">
<link rel="StyleSheet" type="text/css" href="code.css" tppabs="http://site/bookphp/code.css">
</head>
<body bottommargin="0" marginheight="0" marginwidth="0" rightmargin="0" leftmargin="0" topmargin="0">
<table style="border-bottom-style: solid; border-width: 4px; border-color: #BABABA" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#D8F0FB">
    <tr valign="top">
        <td style="padding-left: 50" height="18" colspan="2">
            <a href="http://www.softtime.ru/" title="IT-студия SoftTime"><img src="images/softtime.gif" tppabs="http://site/bookphp/images/softtime.gif" border="0" width="137" height="18" vspace="10"></a>                    
        </td>
        <td valign="middle" align="right">  
            <a style="color: #607683; font-size: 11px; font-family: Arial, Helvetica, sans-serif;" href="mailto:softtime@softtime.ru">Написать письмо авторам</a>
        </td>
        <td width=10%>&nbsp;</td>
    </tr>
</table>
<table border="0" cellspacing="17" >
    <tr valign="bottom">
        <td width=7%>&nbsp;</td>
        <td width="30%" align="center"><h1 style="font-size: 36; padding-top: 20px;  margin: 0px">УЧЕБНИК&nbsp;PHP</h1></td>
        <td align="center"><img src="images/help.gif" tppabs="http://site/bookphp/images/help.gif" border="0" width="40" height="25" alt=""><br>
            <a class=a1 href="http://www.softtime.ru/bookphp/help.php"  title="Справочник функций языка PHP 4 на сайте IT-студии <SoftTime>"><b>справочник&nbsp;функций&nbsp;<Оnline></b></a>
        </td>
        <td align="center"><img src="images/aboutbook.gif" tppabs="http://site/bookphp/images/aboutbook.gif" border="0" width="25" height="25" alt=""><br>
            <a title="Об учебнике и его авторах" class=a1 href="aboutbook.php.htm" tppabs="http://site/bookphp/aboutbook.php"><b>Об&nbsp;учебнике</b></a>
        </td>
        <td align="center"><img src="images/updatebook.gif" tppabs="http://site/bookphp/images/updatebook.gif" border="0" width="40" height="25" alt=""><br>
            <a target="_blank" title="Проверить обновления учебника" class=a1 href="http://www.softtime.ru/info/bookphp.php"><b>Обновление</b></a>
        </td>       
    </tr>
</table><br>
<a name="up"></a>
<table border="0" cellspacing="0" cellpadding="0">
    <tr valign="top">
        <td width="25%">
            <table border="0" width="100%">
                <tr>
                    <td style="background-image: url(images/linebook1.gif); background-repeat: no-repeat"  height="5" width="213"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
                </tr>
                <tr align="left">
                    <td><p style="color: #1020E3; font-size: 16px; margin-left: 10"><b>Оглавление</b></p></td>
                </tr>
                <tr>
                    <td style="background-image: url(images/linebook2.gif); background-repeat: no-repeat" height="7"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
                </tr>
                <tr>
                    <td width="213">
                        <ol>
                            <li><a class=bookmenu href="gl1_1.php.htm" tppabs="http://site/bookphp/gl1_1.php">Основы PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl2_1.php.htm" tppabs="http://site/bookphp/gl2_1.php">Операторы языка PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl3_1.php.htm" tppabs="http://site/bookphp/gl3_1.php">Строковые функции</a></li>
                                    
                            <li><a class=bookmenu href="gl4_1.php.htm" tppabs="http://site/bookphp/gl4_1.php">Массивы</a>
                                
                            </li>                                                           
                            <li><a class=bookmenu href="gl5_1.php.htm" tppabs="http://site/bookphp/gl5_1.php">Функции</a>
                                                        </li>
                            <li><a class=bookmenu href="gl6_1.php.htm" tppabs="http://site/bookphp/gl6_1.php">Работа с файлами</a>
                                                            <div id="activechapter">
                                    <p class=subchapter><a class=bookmenu href="gl6_1.php.htm" tppabs="http://site/bookphp/gl6_1.php"><nobr>Открытие файлов</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_2.php.htm" tppabs="http://site/bookphp/gl6_2.php"><nobr>Отображение файлов</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_3.php.htm" tppabs="http://site/bookphp/gl6_3.php"><nobr>Закрытие файлов</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_4.php.htm" tppabs="http://site/bookphp/gl6_4.php"><nobr>Чтение и запись</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_5.php.htm" tppabs="http://site/bookphp/gl6_5.php"><nobr>Копирование, удаление</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_6.php.htm" tppabs="http://site/bookphp/gl6_6.php"><nobr>Атрибуты файлов</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_7.php.htm" tppabs="http://site/bookphp/gl6_7.php"><nobr>Перемещение по файлам</nobr></a></b></p>
                                    <p class=subchapter><b><a class=bookmenu href="gl6_8.php.htm" tppabs="http://site/bookphp/gl6_8.php"><nobr>Работа с каталогами</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl6_9.php.htm" tppabs="http://site/bookphp/gl6_9.php"><nobr>Методы PUT и POST</nobr></a></b></p>                                    
                                </div>
                                                        </li>
                            <li ><a class=bookmenu href="gl7_1.php.htm" tppabs="http://site/bookphp/gl7_1.php">Регулярные выражения</a>
                                                        </li>
                            <li ><a class=bookmenu href="gl8_1.php.htm" tppabs="http://site/bookphp/gl8_1.php">Сессии и cookies в PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl9_1.php.htm" tppabs="http://site/bookphp/gl9_1.php">Работа с FTP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl10_1.php.htm" tppabs="http://site/bookphp/gl10_1.php">Проверка данных</a>
                                                        </li>
                            <li><a class=bookmenu href="gl11_1.php.htm" tppabs="http://site/bookphp/gl11_1.php">Гостевая книга</a>
                                                        </li>
                            <li class="newchaptr"><a class=bookmenu href="gl12_1.php.htm" tppabs="http://site/bookphp/gl12_1.php">PHP и MySQL</a>
                                                        </li>
                            
                        </ol>
                        <p><i>Продолжение следует</i></p>
                    </td>
                </tr>
            </table>
        </td>
        <td ><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<br><br>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<table border="0" cellpadding="0" cellspacing="0" height="70">
    <tr>
        <td rowspan="3" width="70"><img src="images/book.gif" tppabs="http://site/bookphp/images/book.gif" border="0" width="59" height="44" alt=""></td>
        <td height="50" valign="middle"><h1 class=namepage>Работа с файлами</h1></td>
    </tr>
    <tr>
        <td height="7px" bgcolor="#9FB6C9"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
    </tr>
    <tr><td height="13"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td></tr>
</table><table border="0" align="right" cellpadding="0" cellspacing="7">
    <tr valign="middle" align="center">
        <td><img src="images/arrowleft.gif" tppabs="http://site/bookphp/images/arrowleft.gif" border="0" width="10" height="17" alt=""></td>
        <td><a class=a1 href="gl6_7.php.htm" tppabs="http://site/bookphp/gl6_7.php">Предыдущая</a></td>
        <td width="1" bgcolor="silver"></td>
        <td><a class=a1 href="gl6_9.php.htm" tppabs="http://site/bookphp/gl6_9.php">Следующая</a></td>
        <td><img src="images/arrowright.gif" tppabs="http://site/bookphp/images/arrowright.gif" border="0" width="10" height="17" alt=""></td>
    </tr>
    <td colspan="5" bgcolor="silver"></td>
</table>
<h1 class=p1>Работа с каталогами</h1>
<br>
<br>

<p class=text>Для установки текущего каталога применяется функция <b>chdir</b>:</p>
<blockquote><pre>
  <em class=gr>int</em> <b>chdir</b> <em class=gr>( string</em> <b>directory</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>Работать с этой функцией можно следующим образом:</p>
<ul>
  <li><b>chdir</b><em class=gr>(</em>"/tmp/data"<em class=gr>);</em><em class=comnt> // переход по абсолютному пути</em></li>
  <li><b>chdir</b><em class=gr>(</em>"./js"<em class=gr>);</em><em class=comnt> // переход в подкаталог текущего каталога</em></li>
  <li><b>chdir</b><em class=gr>(</em>".."<em class=gr>);</em><em class=comnt> // переход в родительский каталог</em></li>
  <li><b>chdir</b><em class=gr>(</em>"~/data"<em class=gr>);</em><em class=comnt> // переходим в /home/пользователь/data (для Unix)</em></li>
</ul>
<p class=text>Чтобы узнать текущий каталог можно воспользоваться функцией <b>getcwd</b>:</p>
<blockquote><pre>
  <em class=gr>string</em> <b>getcwd</b> <em class=gr>( string</em> <b>path</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>Для того чтобы открыть каталог используется функция <b>opendir</b>, открывающая каталог, заданный параметром path:</p>
<blockquote><pre>
  <em class=gr>int</em> <b>opendir</b> <em class=gr>( string</em> <b>path</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>После того, как каталог открыт, прочитать его можно функцией <b>readdir</b>:</p>
<blockquote><pre>
  <em class=gr>string</em> <b>readdir</b> <em class=gr>( int</em> <b>dir</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>Эта функция возвращает имена элементов, содержащихся в каталоге. Кроме файлов и папок в каталогах находятся также элементы "." и "..". Первый элемент указывает на текущий каталог, а второй - на родительский. Текущий каталог, кстати, можно открыть, указав его имя как ".":</p>
<blockquote><pre>
   <b>$dir</b><em class=gr> =</em> <b>opendir</b> <em class=gr>(</em>"."<em class=gr>);</em>
</pre></blockquote>
<p class=text>После того, как работа с каталогом закончена, его нужно закрыть. Закрытие каталога выполняется при помощи функции <b>closedir</b>:</p>
<blockquote><pre>
  <em class=gr>void</em> <b>closedir</b> <em class=gr>(</em><b>$dir</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>Ниже приведен пример, осуществляющий чтение и вывод файлов, находящихся в текущем каталоге.</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$dir</b><em class=gr> =</em> <b>opendir</b> <em class=gr>(</em>"."<em class=gr>);
  echo</em> "Files:\n"<em class=gr>;
  while (</em><b>$file</b><em class=gr> =</em> <b>readdir</b> <em class=gr>(</em><b>$dir</b><em class=gr>)) 
  {
    echo</em> "<b>$file</b>&lt;br&gt;"<em class=gr>;
  }</em>
  <b>closedir</b> <em class=gr>(</em><b>$dir</b><em class=gr>);</em>
<em class=red>?&gt;</em>
</pre></blockquote>

<p class=text>Заметим, что эта функция возвращает также "." и "..". Если этого делать не нужно, то исключить эти значения можно следующим образом:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$dir</b><em class=gr> =</em> <b>opendir</b> <em class=gr>(</em>"."<em class=gr>);
  while ( </em><b>$file</b><em class=gr> =</em> <b>readdir</b> <em class=gr>(</em><b>$dir</b><em class=gr>))
  {
    if (( </em><b>$file</b><em class=gr> !=</em> "."<em class=gr>) && (</em><b>$file</b><em class=gr> !=</em> ".."<em class=gr>))
    {
      echo</em> "<b>$file</b>&lt;br&gt;"<em class=gr>;
    }
  }</em>
  <b>closedir</b> <em class=gr>(</em><b>$dir</b><em class=gr>);</em>
<em class=red>?&gt;</em>
</pre></blockquote>

<p class=text>В качестве примера на рассмотренные функции, давайте создадим скрипт, удаляющий все файлы из каталога c:/temp, к которым не было доступа в течение суток. Функция удаления файлов в этом случае вызывается рекурсивно.</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <em class=gr>function</em> <b>delTemporaryFiles</b> <em class=gr>(</em><b>$directory</b><em class=gr>)
  {</em>
  <b>$dir</b><em class=gr> =</em> <b>opendir</b> <em class=gr>(</em><b>$directory</b><em class=gr>);
  while (( </em><b>$file</b><em class=gr> =</em> <b>readdir</b> <em class=gr>(</em><b>$dir</b><em class=gr>)))
  {
    if( </em><b>is_file</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>))
    {</em>
      <b>$acc_time</b><em class=gr> =</em> <b>fileatime</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>);</em>
      <b>$time</b><em class=gr> = </em> <b>time</b>();
      if ((</em><b>$time</b><em class=gr> - </em><b>$acc_time</b><em class=gr>) > </em>24*60*60<em class=gr>)
      {
        if ( </em> <b>unlink</b> <em class=gr>(</em><b>$directory.</b>"/".<b>$file</b><em class=gr>))
        {
          echo (</em>"Файлы успешно удалены"<em class=gr>);
        }
      }
    }
    else if ( </em><b>is_dir</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>) && (</em><b>$file</b><em class=gr> !=</em> "."<em class=gr>) && (</em><b>$file</b><em class=gr> != </em>".."<em class=gr>))
    {</em>
      <b>delTemporaryFiles</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>);
    }
  }</em>
  <b>closedir</b> <em class=gr>(</em><b>$dir</b><em class=gr>);
  }</em>
  <b>delTemporaryFiles</b> <em class=gr>(</em>"c:/temp"<em class=gr>);</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Создание каталогов производится с помощью функции <b>mkdir</b>:</p>
<blockquote><pre>
  <em class=gr>bool</em> <b>mkdir</b> <em class=gr>( string</em> <b>dirname</b>, <em class=gr>int</em> <b>mode</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>Эта функция создает каталог с именем dirname и правами доступа mode. В случае неудачи возвращает false. Права доступа задаются только для каталогов UNIX, поскольку в Windows этот аргумент игнорируется. Ниже приведен пример создания каталога test в директории c:/temp.</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$flag</b><em class=gr> =</em> <b>mkdir</b> <em class=gr>(</em>"c:/temp/test", 0700<em class=gr>);
  if(</em><b>$flag</b><em class=gr>)
  {
    echo(</em>"Каталог успешно создан"<em class=gr>);
  }
  else
  {
    echo(</em>"Ошибка создания каталога"<em class=gr>);
  }</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Удалить каталог можно с помощью функции <b>rmdir</b>:</p>
<blockquote><pre>
  <em class=gr>bool</em> <b>rmdir</b> <em class=gr>( string</em> <b>dirname</b><em class=gr>)</em>
</pre></blockquote>
<p class=text>Теперь удалим только что созданный каталог /test:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$flag</b><em class=gr> =</em> <b>rmdir</b> <em class=gr>(</em>"c:/temp/test"<em class=gr>);
  if(</em><b>$flag</b><em class=gr>)
  {
    echo(</em>"Каталог успешно удален"<em class=gr>);
  }
  else
  {
    echo(</em>"Ошибка удаления каталога"<em class=gr>);
  }</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Функция <b>rmdir</b> удаляет только пустые каталоги. Для того чтобы удалять непустые каталоги, давайте напишем функцию и удалим каталог c:/temp со всеми вложенными папками и файлами:</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <em class=gr>function</em> <b>full_del_dir</b> <em class=gr>(</em><b>$directory</b><em class=gr>)
  {</em>
  <b>$dir</b><em class=gr> = opendir(</em><b>$directory</b><em class=gr>);
  while((</em><b>$file</b><em class=gr> = readdir(</em><b>$dir</b><em class=gr>)))
  {
    if (</em> <b>is_file</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>))
    {</em>
      <b>unlink</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>);
    }
    else if (</em> <b>is_dir</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>) &&
             (</em><b>$file</b><em class=gr> != </em>"."<em class=gr>) && (</em><b>$file</b><em class=gr> != </em>".."<em class=gr>))
    {</em>
      <b>full_del_dir</b> <em class=gr>(</em><b>$directory</b>."/".<b>$file</b><em class=gr>);  
    }
  }</em>
  <b>closedir</b> <em class=gr>(</em><b>$dir</b><em class=gr>);</em>
  <b>rmdir</b> <em class=gr>(</em><b>$directory</b><em class=gr>);
  echo(</em>"Каталог успешно удален"<em class=gr>);
  }</em>
  <b>full_del_dir</b> <em class=gr>(</em>"c:/temp"<em class=gr>)</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>При рекурсивном вызове функции не передавайте в качестве аргументов записи "." и "..", указывающие на текущий и родительский каталоги, так как в этом случае вы можете потерять ваши данные. Пропускайте эти записи явным образом при помощи условного оператора.</p>

<br>
<br>
<table border="0" align="center" cellpadding="0" cellspacing="0">
    <tr>
        <td colspan="5" align="center"><img src="images/linebook1.gif" tppabs="http://site/bookphp/images/linebook1.gif" border="0" width="212" height="5" alt=""></td>
    </tr>
    <tr valign="middle" align="center">
        <td><img src="images/arrowleft.gif" tppabs="http://site/bookphp/images/arrowleft.gif" border="0" width="10" height="17" alt=""></td>
        <td><a class=a1 href="gl6_7.php.htm" tppabs="http://site/bookphp/gl6_7.php">Предыдущая</a></td>
        <td width="1" bgcolor="silver"></td>
        <td><a class=a1 href="gl6_9.php.htm" tppabs="http://site/bookphp/gl6_9.php">Следующая</a></td>
        <td><img src="images/arrowright.gif" tppabs="http://site/bookphp/images/arrowright.gif" border="0" width="10" height="17" alt=""></td>
    </tr>
    <tr>
        <td colspan="5" align="center"><img src="images/linebook2.gif" tppabs="http://site/bookphp/images/linebook2.gif" border="0" width="213" height="11" alt=""></td>
    </tr>
</table>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
            </p>
        </td>   
        <td width="7%">&nbsp;</td>  
    </tr>
</table>
<table border="0" width="100%">
    <tr>
        <td width=20%>&nbsp;</td>
        <td>
            <a class=a1 href="#up">Наверх</a>
        </td>
    </tr>
</table><br>
</body>
</html>    