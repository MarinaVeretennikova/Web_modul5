<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Регулярные выражения | Perl-совместимые регулярные выражения</title>
<link rel="StyleSheet" type="text/css" href="book4.css" tppabs="http://site/bookphp/book4.css">
<link rel="StyleSheet" type="text/css" href="code.css" tppabs="http://site/bookphp/code.css">
</head>
<body bottommargin="0" marginheight="0" marginwidth="0" rightmargin="0" leftmargin="0" topmargin="0">
<table style="border-bottom-style: solid; border-width: 4px; border-color: #BABABA" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#D8F0FB">
    <tr valign="top">
        <td style="padding-left: 50" height="18" colspan="2">
            <a href="http://www.softtime.ru/" title="IT-студия SoftTime"><img src="images/softtime.gif" tppabs="http://site/bookphp/images/softtime.gif" border="0" width="137" height="18" vspace="10"></a>                    
        </td>
        <td valign="middle" align="right">  
            <a style="color: #607683; font-size: 11px; font-family: Arial, Helvetica, sans-serif;" href="mailto:softtime@softtime.ru">Написать письмо авторам</a>
        </td>
        <td width=10%>&nbsp;</td>
    </tr>
</table>
<table border="0" cellspacing="17" >
    <tr valign="bottom">
        <td width=7%>&nbsp;</td>
        <td width="30%" align="center"><h1 style="font-size: 36; padding-top: 20px;  margin: 0px">УЧЕБНИК&nbsp;PHP</h1></td>
        <td align="center"><img src="images/help.gif" tppabs="http://site/bookphp/images/help.gif" border="0" width="40" height="25" alt=""><br>
            <a class=a1 href="http://www.softtime.ru/bookphp/help.php"  title="Справочник функций языка PHP 4 на сайте IT-студии <SoftTime>"><b>справочник&nbsp;функций&nbsp;<Оnline></b></a>
        </td>
        <td align="center"><img src="images/aboutbook.gif" tppabs="http://site/bookphp/images/aboutbook.gif" border="0" width="25" height="25" alt=""><br>
            <a title="Об учебнике и его авторах" class=a1 href="aboutbook.php.htm" tppabs="http://site/bookphp/aboutbook.php"><b>Об&nbsp;учебнике</b></a>
        </td>
        <td align="center"><img src="images/updatebook.gif" tppabs="http://site/bookphp/images/updatebook.gif" border="0" width="40" height="25" alt=""><br>
            <a target="_blank" title="Проверить обновления учебника" class=a1 href="http://www.softtime.ru/info/bookphp.php"><b>Обновление</b></a>
        </td>       
    </tr>
</table><br>
<a name="up"></a>
<table border="0" cellspacing="0" cellpadding="0">
    <tr valign="top">
        <td width="25%">
            <table border="0" width="100%">
                <tr>
                    <td style="background-image: url(images/linebook1.gif); background-repeat: no-repeat"  height="5" width="213"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
                </tr>
                <tr align="left">
                    <td><p style="color: #1020E3; font-size: 16px; margin-left: 10"><b>Оглавление</b></p></td>
                </tr>
                <tr>
                    <td style="background-image: url(images/linebook2.gif); background-repeat: no-repeat" height="7"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
                </tr>
                <tr>
                    <td width="213">
                        <ol>
                            <li><a class=bookmenu href="gl1_1.php.htm" tppabs="http://site/bookphp/gl1_1.php">Основы PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl2_1.php.htm" tppabs="http://site/bookphp/gl2_1.php">Операторы языка PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl3_1.php.htm" tppabs="http://site/bookphp/gl3_1.php">Строковые функции</a></li>
                                    
                            <li><a class=bookmenu href="gl4_1.php.htm" tppabs="http://site/bookphp/gl4_1.php">Массивы</a>
                                
                            </li>                                                           
                            <li><a class=bookmenu href="gl5_1.php.htm" tppabs="http://site/bookphp/gl5_1.php">Функции</a>
                                                        </li>
                            <li><a class=bookmenu href="gl6_1.php.htm" tppabs="http://site/bookphp/gl6_1.php">Работа с файлами</a>
                                                        </li>
                            <li ><a class=bookmenu href="gl7_1.php.htm" tppabs="http://site/bookphp/gl7_1.php">Регулярные выражения</a>
                                                            <div id="activechapter">
                                    <p class=subchapter><a class=bookmenu href="gl7_1.php.htm" tppabs="http://site/bookphp/gl7_1.php"><nobr>Регулярные выражения </nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_2.php.htm" tppabs="http://site/bookphp/gl7_2.php"><nobr>Групповой символ</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_3.php.htm" tppabs="http://site/bookphp/gl7_3.php"><nobr>Ветви</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_4.php.htm" tppabs="http://site/bookphp/gl7_4.php"><nobr>Исключающее выражение</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_5.php.htm" tppabs="http://site/bookphp/gl7_5.php"><nobr>Квалификаторы</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_6.php.htm" tppabs="http://site/bookphp/gl7_6.php"><nobr>Границы</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_7.php.htm" tppabs="http://site/bookphp/gl7_7.php"><nobr>Подвыражения</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_8.php.htm" tppabs="http://site/bookphp/gl7_8.php"><nobr>Начало и конец строки</nobr></a></b></p>
                                    <p class=subchapter><a class=bookmenu href="gl7_9.php.htm" tppabs="http://site/bookphp/gl7_9.php"><nobr>Спец символы</nobr></a></b></p>                                 
                                    <p class=subchapter><a class=bookmenu href="gl7_10.php.htm" tppabs="http://site/bookphp/gl7_10.php"><nobr>Классы символов</nobr></a></b></p>                                    
                                    <p class=subchapter><a class=bookmenu href="gl7_11.php.htm" tppabs="http://site/bookphp/gl7_11.php"><nobr>Функции для работы </nobr></a></b></p>                                    
                                    <p class=subchapter><b><a class=bookmenu href="gl7_12.php.htm" tppabs="http://site/bookphp/gl7_12.php"><nobr>Perl-совместимые выражения</nobr></a></b></p>                                                                                                                                              
                                </div>
                                                        </li>
                            <li ><a class=bookmenu href="gl8_1.php.htm" tppabs="http://site/bookphp/gl8_1.php">Сессии и cookies в PHP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl9_1.php.htm" tppabs="http://site/bookphp/gl9_1.php">Работа с FTP</a>
                                                        </li>
                            <li><a class=bookmenu href="gl10_1.php.htm" tppabs="http://site/bookphp/gl10_1.php">Проверка данных</a>
                                                        </li>
                            <li><a class=bookmenu href="gl11_1.php.htm" tppabs="http://site/bookphp/gl11_1.php">Гостевая книга</a>
                                                        </li>
                            <li class="newchaptr"><a class=bookmenu href="gl12_1.php.htm" tppabs="http://site/bookphp/gl12_1.php">PHP и MySQL</a>
                                                        </li>
                            
                        </ol>
                        <p><i>Продолжение следует</i></p>
                    </td>
                </tr>
            </table>
        </td>
        <td ><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<br><br>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<table border="0" cellpadding="0" cellspacing="0" height="70">
    <tr>
        <td rowspan="3" width="70"><img src="images/book.gif" tppabs="http://site/bookphp/images/book.gif" border="0" width="59" height="44" alt=""></td>
        <td height="50" valign="middle"><h1 class=namepage>Регулярные выражения</h1></td>
    </tr>
    <tr>
        <td height="7px" bgcolor="#9FB6C9"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td>
    </tr>
    <tr><td height="13"><img src="images/pic.gif" tppabs="http://site/bookphp/images/pic.gif" border="0" width="1" height="1" alt=""></td></tr>
</table><table border="0" align="right" cellpadding="0" cellspacing="7">
    <tr valign="middle" align="center">
        <td><img src="images/arrowleft.gif" tppabs="http://site/bookphp/images/arrowleft.gif" border="0" width="10" height="17" alt=""></td>
        <td><a class=a1 href="gl7_11.php.htm" tppabs="http://site/bookphp/gl7_11.php">Предыдущая</a></td>
        <td width="1" bgcolor="silver"></td>
        <td><a class=a1 href="gl8_1.php.htm" tppabs="http://site/bookphp/gl8_1.php">Следующая</a></td>
        <td><img src="images/arrowright.gif" tppabs="http://site/bookphp/images/arrowright.gif" border="0" width="10" height="17" alt=""></td>  
    </tr>
    <td colspan="5" bgcolor="silver"></td>
</table>
<h1 class=p1>Perl-совместимые регулярные выражения</h1>
<br>
<br>

<p class=text>PHP поддерживает ряд функций для работы с Perl-совместимыми регулярными выражениями (PCRE - Perl Compatible Regular Expression). Такие выражения заключаются в ограничители, в качестве которых, как правило, используется прямой слеш:</p>
<blockquote><pre>
/mail/
</pre></blockquote>
<p class=text>Это выражение соответствует строке, содержащей слово "mail".</p>
<p class=text>За ограничителями могут следовать <b>модификаторы</b>, уточняющие регулярное выражение. Наиболее часто используют следующие модификаторы:</p>
<ul>
  <li><b>i</b> (Игнорировать регистр при поиске соответствия. Т. е. выражение "/mail/i" будет соответствовать как строке "MAIL", так и строке "mail".);</li>
  <li><b>x</b> (Игнорировать пробельные символы).</li>
</ul>
<p class=text>Для PCRE-выражений характерно применение <b>общих типов символов</b>, которые аналогичны классам символов для регулярных выражений в стиле POSIX. Наиболее часто встречающиеся общие типы символов приведены ниже.</p>
<ul>
  <li><b>\d</b> - соответствие десятичной цифре</li>
  <li><b>\D</b> - соответствие любому символу, за исключением десятичных цифр</li>
  <li><b>\s</b> - соответствие пробельным символам</li>
  <li><b>\S</b> - соответствие любым символам, кроме пробельных</li>
  <li><b>\h</b> - наличие границы слова</li>
  <li><b>\B</b> - отсутствие границы слова</li>
  <li><b>\Z</b> - конец строки или символ перевода конца строки</li>
  <li><b>\A</b> - начало строки</li>
</ul>
<p class=text>Теперь рассмотрим основные функции, которые есть в PHP для работы с PCRE-выражениями.</p>
<h3 class=p1>preg_match()</h3>
<blockquote><pre>
  <em class=gr>int</em> <b>preg_match</b><em class=gr> (string</em><b> pattern</b>,<em class=gr> string</em><b> subject</b> [,<em class=gr> array</em><b> matches</b>]<em class=gr>)</em>
</pre></blockquote>
<p class=text>Эта функция ищет в строке <b>subject</b> соответствие регулярному выражению <b>pattern</b>. Если задан необязательный параметр <b>matches</b>, то результаты поиска помещаются в массив.</p>
<p class=text>Приведем несколько примеров.</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$str</b><em class=gr> = </em>"PHP один из лучших языков программирования для Web"<em class=gr>;</em>
  <b>if</b><em class=gr> (</em><b>preg_match</b><em class=gr> (</em>"/php/i", <b>$str</b><em class=gr>)) 
  {
    echo(</em>"Соответствие найдено"<em class=gr>);
  }</em>
  <b>else</b><em class=gr>
  {
    echo(</em>"Соответствие не найдено"<em class=gr>);
  }</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Результат:</p>
<blockquote><pre>
Соответствие найдено
</pre></blockquote>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$str</b><em class=gr> = </em>"PHP один из лучших языков программирования для Web"<em class=gr>;</em>
  <b>if</b><em class=gr> (</em><b>preg_match</b><em class=gr> (</em>"/\bweb\b/i", <b>$str</b><em class=gr>)) 
  {
    echo(</em>"Соответствие найдено"<em class=gr>);
  }</em>
  <b>else</b><em class=gr>
  {
    echo(</em>"Соответствие не найдено"<em class=gr>);
  }</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Результат:</p>
<blockquote><pre>
Соответствие найдено
</pre></blockquote>
<blockquote><pre>
<em class=red>&lt;?</em>
  //<em class=comnt> получаем www-адрес (имя хоста) из url</em>
  <b>$url</b><em class=gr> = </em>"http://www.php.net/download.html"<em class=gr>;</em>
  <b>preg_match</b><em class=gr>(</em>"/^(http:\/\/)?([^\/]+)/i", <b>$url</b>, <b>$matches</b><em class=gr>);</em>
  <b>$host</b><em class=gr> = </em><b>$matches[2]</b><em class=gr>;
  echo(</em>"www-адрес: <b>$host</b>"<em class=gr>);
  echo(</em>"&lt;br&gt;"<em class=gr>);</em>
  //<em class=comnt> получаем последние два сегмента имени хоста (доменное имя)</em>
  <b>preg_match</b><em class=gr>(</em>"/[^\.\/]+\.[^\.\/]+$/", <b>$host</b>, <b>$matches</b><em class=gr>);
  echo</em> "доменное имя: {<b>$matches[0]</b>}\n"<em class=gr>;</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Результат:</p>
<blockquote><pre>
www-адрес: www.php.net
доменное имя: php.net
</pre></blockquote>
<h3 class=p1>preg_replace()</h3>
<blockquote><pre>
<em class=gr>mixed</em><b> preg_replace</b><em class=gr> (mixed </em><b>pattern</b>, <em class=gr>mixed</em><b> replacement</b>, <em class=gr>mixed </em><b>subject</b>
                            [,<em class=gr>int</em><b> limit</b>]<em class=gr>)</em>
</pre></blockquote>
<p class=text>Эта функция ищет в строке <b>subject</b> соответствия регулярному выражению <b>pattern</b>, и заменяет их на <b>replacement</b>. Необязательного параметр <b>limit</b> задает число соответствий, которые надо заменить. Если этот параметр не указан, или равен -1, то заменяются все найденные соответствия.</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>$str</b><em class=gr> = </em>"May 15, 2003"<em class=gr>;</em>
  <b>$pattern</b><em class=gr> = </em>"/(\w+) (\d+), (\d+)/i"<em class=gr>;</em>
  <b>$replacement</b><em class=gr> = </em>"1 \${1} \$3"<em class=gr>;
  print</em><b> preg_replace</b><em class=gr>(</em><b>$pattern</b>, <b>$replacement</b>, <b>$str</b><em class=gr>);</em>
<em class=red>?&gt;</em>
</pre></blockquote>
<p class=text>Результат:</p>
<blockquote><pre>
1 May 2003
</pre></blockquote>
<p class=text>А вот как можно написать функцию, которая будет практически полным аналогом функции <b>htmlspecialchars</b>.</p>
<blockquote><pre>
<em class=red>&lt;?</em>
  <b>function my_htmlspecialchats</b><em class=gr>(</em><b>$document</b><em class=gr>)
  {</em>
    <b>$search</b><em class=gr> = array (</em>"'<script[^>]*?>.*?</script>'si",  
                     "'<[\/\!]*?[^<>]*?>'si",           
                     "'([\r\n])[\s]+'",                 
                     "'&(quot|#34);'i",                 
                     "'&(amp|#38);'i",
                     "'&(lt|#60);'i",
                     "'&(gt|#62);'i",
                     "'&(nbsp|#160);'i",
                     "'&(iexcl|#161);'i",
                     "'&(cent|#162);'i",
                     "'&(pound|#163);'i",
                     "'&(copy|#169);'i",
                     "'&#(\d+);'e"<em class=gr>);</em>
    <b>$replace</b><em class=gr> = array (</em>"",
                      "",
                      "\\1",
                      "\"",
                      "&",
                      "<",
                      ">",
                      " ",
                      chr(161),
                      chr(162),
                      chr(163),
                      chr(169),
                      "chr(\\1)"<em class=gr>);</em>
    <b>$text</b><em class=gr> = </em><b>preg_replace</b><em class=gr> (</em><b>$search</b>, <b>$replace</b>, <b>$document</b><em class=gr>);</em>
    <b>return $text</b><em class=gr>;
  }</em>
  <b>$doc</b><em class=gr> = </em>"<javascript>alert;</script>"; //<em class=comnt> напишем java-скрипт</em>
  <b>my_htmlspecialchats</b><em class=gr>(</em><b>$doc</b><em class=gr>);</em>  //<em class=comnt> выводит "alert;"</em>
  <em class=gr>echo(</em><b>$doc</b><em class=gr>);</em>
<em class=red>?&gt;</em>
</pre></blockquote>

<br>
<br>
<table border="0" align="center" cellpadding="0" cellspacing="0">
    <tr>
        <td colspan="5" align="center"><img src="images/linebook1.gif" tppabs="http://site/bookphp/images/linebook1.gif" border="0" width="212" height="5" alt=""></td>
    </tr>
    <tr valign="middle" align="center">
        <td><img src="images/arrowleft.gif" tppabs="http://site/bookphp/images/arrowleft.gif" border="0" width="10" height="17" alt=""></td>
        <td><a class=a1 href="gl7_11.php.htm" tppabs="http://site/bookphp/gl7_11.php">Предыдущая</a></td>
        <td width="1" bgcolor="silver"></td>
        <td><a class=a1 href="gl8_1.php.htm" tppabs="http://site/bookphp/gl8_1.php">Следующая</a></td>
        <td><img src="images/arrowright.gif" tppabs="http://site/bookphp/images/arrowright.gif" border="0" width="10" height="17" alt=""></td>
    </tr>
    <tr>
        <td colspan="5" align="center"><img src="images/linebook2.gif" tppabs="http://site/bookphp/images/linebook2.gif" border="0" width="213" height="11" alt=""></td>
    </tr>
</table>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
            </p>
        </td>   
        <td width="7%">&nbsp;</td>  
    </tr>
</table>
<table border="0" width="100%">
    <tr>
        <td width=20%>&nbsp;</td>
        <td>
            <a class=a1 href="#up">Наверх</a>
        </td>
    </tr>
</table><br>
</body>
</html> 