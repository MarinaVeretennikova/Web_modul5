<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta http-equiv="Content-Language" content="ru"><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><TITLE>ldap_search</TITLE>
<LINK REL="stylesheet" HREF="../style.css"></HEAD>
<BODY><TABLE BORDER="0" WIDTH="100%" HEIGHT="100%"><TR><TD COLSPAN="3"><TABLE BGCOLOR="#CCCCFF" BORDER="0" WIDTH="100%"><TR><TD>
<TABLE WIDTH="100%"  BORDER="0"CELLPADDING="3"><TR><TH COLSPAN="3">Учебник РНР</TH></TR><TR><TD WIDTH="10%">
<A HREF="ldap-rename.html">Назад</A></TD><TD WIDTH="80%"></TD><TD WIDTH="10%" ALIGN="right">
<A HREF="ldap-set-option.html">Вперёд</A></TD></TR></TABLE></TD></TR><TR BGCOLOR="#333366"><TD><IMG SRC="../imag/spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR></TABLE></TD></TR><TR><TD><IMG SRC="../imag/spacer.gif" WIDTH="10" HEIGHT="1"></TD><TD HEIGHT="100%" VALIGN="TOP" WIDTH="100%">
<H1><A NAME="function.ldap-search">ldap_search</A></H1><A NAME="AEN39672"></A><P>(PHP 3, PHP 4)</P>
<p>ldap_search - ищет дерево LDAP.<A NAME="AEN39675"></A></p><H2>Описание</H2>
<p>resource <B>ldap_search</B> (resource link_identifier, string base_dn, string filter [, array attributes [, int attrsonly [, int sizelimit [, int timelimit [, int deref]]]]])</p>
<P>Возвращает идентификатор результата поиска, <TT><B>FALSE</B></TT> при ошибке.</P>
<P><B>ldap_search()</B> выполняет поиск специфицированного фильтра в директории с областью видимости
LDAP_SCOPE_SUBTREE. Это эквивалентно поиску по всей директории.<br><TT><I>base_dn</I></TT> специфицирует базовый DN для директории.</P>
<P>Имеется необязательный четвёртый параметр, который можно добавлять для 
ограничения атрибутов и значений, возвращаемых сервером, только теми, которые 
необходимы. Это более эффективно, чем акция по умолчанию (которая возвращает 
все атрибуты и их ассоциированные значения). Использование четвёртого параметра поэтому следует приветствовать.</P>
<P>Четвёртый параметр является стандартным строковым PHP-массивом из 
требуемых атрибутов, например, array("mail","sn","cn"). Заметьте, что
"dn" возвращается всегда, вне зависимости от того, атрибуты каких типов запрошены.</P>
<P>Отметьте, также, что некоторые хосты серверов директорий будут 
сконфигурированы таким образом, чтобы возвращать не более предустановленного количества вхождений. Если это так,
сервер укажет, что он возвращает только частичный результирующий набор. Это 
проявится также в том случае, если шестой параметр <TT><I>sizelimit</I></TT> использован для ограничения подсчёта извлечённых вхождений.</P>
<P>Пятый параметр <TT><I>attrsonly</I></TT> должен иметь значение 1, если нужны только типы атрибутов. 
Если установлен в 0, - и типы, и значения атрибутов извлекаются. Это поведение по умолчанию.</P>
<P>С помощью шестого параметра <TT><I>sizelimit</I></TT> можно ограничить подсчёт извлечённых вхождений. 
Значение 0 означает - нет ограничений. <b>ПРИМЕЧАНИЕ</b>: этот параметр НЕ может переопределить серверную 
установку sizelimit. Но вы можете установить его ниже.</P>
<P>Седьмой параметр <TT><I>timelimit</I></TT> устанавливает количество секунд, отводимых для поиска. 
Установка 0 означает отсутствие ограничения. <b>ПРИМЕЧАНИЕ</b>: этот параметр НЕ может переопределить серверную
установку timelimit. Но вы можете установить его ниже.</P>
<P>Восьмой параметр <TT><I>deref</I></TT> специфицирует, как псевдонимы должны обрабатываться при поиске. Может иметь 
одно из следующих значений:<UL><LI><P>LDAP_DEREF_NEVER - (по умолчанию) псевдонимы никогда не разыменовываются.</P></LI>
<LI><P>LDAP_DEREF_SEARCHING - псевдонимы должны разыменовываться в процессе 
поиска, но не разыменовываются при локализации базового объекта поиска.</P></LI>
<LI><P>LDAP_DEREF_FINDING - псевдонимы должны разыменовываться при локализации 
базового объекта, но не в процессе поиска.</P></LI>
<LI><P>LDAP_DEREF_ALWAYS - псевдонимы должны разыменовываться всегда.</P></LI></UL>
<BLOCKQUOTE><P><B>Примечание: </B> следующие необязательные параметры были введены в 4.0.2:
<TT><I>attrsonly</I></TT>, <TT><I>sizelimit</I></TT>, <TT><I>timelimit</I></TT>, <TT><I>deref</I></TT>.</P></BLOCKQUOTE>
<P>Фильтр поиска может быть простым или продвинутым, с использованием булевых 
операций в формате, описанном в документации LDAP (см. в
<A HREF="http://developer.netscape.com/docs/manuals/directory/41/ag/find.htm" TARGET="_top">Netscape Directory SDK</A> полную информацию о фильтрах).</P>
<P>В примере запрашиваются подразделение организации, фамилия,
имя и email-адрес всех работников компании "My Company", где фамилия или 
имя содержит подстроку $person. В этом примере используется булев фильтр для 
сообщения серверу о поиске информации в более чем одном атрибуте.<TABLE WIDTH="100%" BORDER="0"><TR><TD>
<A NAME="AEN39739"></A><h5>Пример 1. LDAP-поиск</h5><TABLE BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5">
<TR><TD><PRE>// $ds это правильный идентификатор ссылки для сервера директорий

// $person это полное или частичное имя работника, например, "Jo"

$dn = "o=My Company, c=US";
$filter="(|(sn=$person*)(givenname=$person*))";
$justthese = array( "ou", "sn", "givenname", "mail");

$sr=ldap_search($ds, $dn, $filter, $justthese);

$info = ldap_get_entries($ds, $sr);

print $info["count"]." entries returned&#60;p&#62;";</PRE></TD></TR></TABLE></TD></TR></TABLE>
<P>Начиная с 4.0.5, можно проводить также параллельные поиски. Для этого 
используйте массив идентификаторов ссылок, а не просто одиночный идентификатор,
в качестве первого аргумента. Если вам не нужен одно и то же базовое DN и 
тот же фильтр для всех поисков, вы можете также использовать массив базовых DNs 
и/или массив фильтров. Эти массивы обязаны быть того же размера, что и массив 
идентификаторов ссылок, поскольку первые вхождения массивов используются для 
первого поиска, вторые вхождения - для второго, и так далее. При выполнении 
параллельных поисков возвращается массив идентификаторов результатов поисков, 
если только не было ошибки - тогда вхождение, соответствующее поиску, будет <TT><B>FALSE</B></TT>. Это очень напоминает нормально возвращённое значение, но идентификатор 
результата всегда возвращается, если поиск был выполнен. В редких случаях нормальный поиск возвращает
<TT><B>FALSE</B></TT>, в то врем как параллельный поиск возвращает идентификатор.</P></TD><TD><IMG SRC="../imag/spacer.gif" WIDTH="10" HEIGHT="1"></TD></TR><TR><TD COLSPAN="3"><TABLE BGCOLOR="#CCCCFF" BORDER="0" WIDTH="100%"><TR BGCOLOR="#333366"><TD><IMG SRC="../imag/spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR><TR><TD>
<TABLE WIDTH="100%"  BORDER="0"CELLPADDING="3"><TR><TD WIDTH="33%" VALIGN="top"><A HREF="ldap-rename.html">Назад</A>
</TD><th WIDTH="34%" VALIGN="top"><A HREF="../index.html">Оглавление</A></th><TD WIDTH="33%" ALIGN="right" VALIGN="top">
<A HREF="ldap-set-option.html">Вперёд</A></TD></TR><TR><TD WIDTH="33%" VALIGN="top">ldap_rename</TD>
<th WIDTH="34%" VALIGN="top"><A HREF="ref.ldap.html">Вверх</A></th><TD WIDTH="33%" ALIGN="right" VALIGN="top">ldap_set_option</TD></TR></TABLE></TD></TR></TABLE></TD></TR></TABLE></BODY></HTML>