  <HTML>
  <HEAD>
  
  <TITLE>Справочное руководство по MySQL версии 4.1.0-alpha. - A  Проблемы и распространенные ошибки</TITLE>
   <style> code {color:purple} tt {color:green} samp {color:navy} pre {color:maroon} </style> <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
  </HEAD>
  <BODY BGCOLOR=white TEXT=#000000 LINK=#101090 VLINK=#7030B0>
Go to the <A HREF="manual.ru_Introduction.html">first</A>, <A HREF="manual.ru_Extending_MySQL.html">previous</A>, <A HREF="manual.ru_Contrib.html">next</A>, <A HREF="manual.ru_Concept_Index.html">last</A> section, <A HREF="manual.ru_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="Problems" HREF="manual.ru_toc.html#Problems">A  Проблемы и распространенные ошибки</A></H1>

<P>
<A NAME="IDX1720"></A>
<A NAME="IDX1721"></A>

</P>
<P>
В этой главе перечислены некоторые распространенные проблемы и сообщения
об ошибках, с которыми приходится сталкиваться пользователям. Вы научитесь
выяснять, в чем заключается проблема и что следует сделать для ее решения.
Кроме того, здесь даны правильные решения некоторых распространенных
проблем.

</P>



<H2><A NAME="What_is_crashing" HREF="manual.ru_toc.html#What_is_crashing">A.1  Как определить, чем вызваны проблемы</A></H2>

<P>
При возникновении проблемы прежде всего следует обнаружить ее источник -
программу или элемент оборудования:

</P>

<ul>
<LI>

Если присутствует один из следующих симптомов, то проблема, скорее
всего, связана с аппаратным обеспечением (с памятью, материнской
платой, процессором или жестким диском) либо с ядром:


<ul>
<LI>

Не работает клавиатура. Обычно ее работоспособность можно проверить по
реакции на нажатие <code>Caps Lock</code>. Если индикатор <code>Caps Lock</code> не меняется, то
клавиатуру необходимо заменить (прежде чем это сделать, следует
попробовать перезагрузить компьютер и проверить все кабели к
клавиатуре).

<LI>

Не перемещается курсор мыши.

<LI>

Машина не отвечает на ping-запросы удаленной машины.

<LI>

Различные не связанные между собой программы не работают, как надо.

<LI>

Система неожиданно перезагрузилась (дефектная программа
пользовательского уровня <strong>никогда</strong> не должна быть способна вызвать отказ
системы).
</ul>

В этом случае необходимо начать с проверки всех кабелей и запуска
диагностических средств для проверки аппаратуры! Следует также проверить,
нет ли патчей, обновлений, сервисных пакетов (<code>service pack</code>) для
используемой операционной системы, при помощи которых вы, возможно, могли
бы решить проблемы. Кроме того, следует удостовериться, что у вас
установлены достаточно свежие версии библиотек (таких как <code>glibc</code>). 

Для
раннего обнаружения проблем хорошо использовать машину с ECC-памятью!

<LI>

В случае блокировки клавиатуры положение можно исправить, если войти
на свою машину с другой машины и выполнить на своей машине <code>kbd_mode</code>
-a.

<LI>

Исследуйте свой системный журнальный файл (<tt>`/var/log/messages'</tt> или т.п.)
на предмет причин возникающих проблем. Если есть основания полагать,
что проблема - в MySQL, то следует также изучить журнальные файлы
MySQL (see section <A HREF="manual.ru_MySQL_Database_Administration.html#Update_log">4.9.3  Журнал обновлений (update)</A>).

<LI>

Если вы считаете, что аппаратные проблемы отсутствуют, следует
попробовать обнаружить вызывающую проблемы программу. Попробуйте с
помощью <code>top</code>, <code>ps</code>, <code>taskmanager</code> или подобной программы проверить, какая
программа забирает все ресурсы процессора или блокирует машину.

<LI>

Проверьте с помощью <code>top</code>, <code>df</code> или подобной программы, нет ли нехватки
памяти, дискового пространства, дескрипторов для открытия файлов или
каких-либо других критических ресурсов.

<LI>

Если проблема связана с бесконтрольным процессом, то всегда можно
попробовать уничтожить его. Если он не хочет уничтожаться, то,
вероятно, существует ошибка в операционной системе.
</ul>

<P>
Если после изучения всех возможных причин вы сделали вывод, что источником
проблемы является именно MySQL-сервер или клиент, то следует сделать отчет
об ошибке для нашего списка рассылки или команды поддержки. В отчете об
ошибке постарайтесь дать очень подробное описание поведения системы и свое
мнение по поводу происходящего. Следует также объяснить, почему вы
считаете, что проблемы вызывает именно MySQL. Примите во внимание все
ситуации, описанные в данном разделе. Опишите все проблемы в точности так,
как они наблюдаются при исследовании системы. При помещении в отчет для
всего вывода программ и/или их сообщений об ошибках и/или подобной
информации из журнальных файлов  используйте метод "вырезать и
вставить"!

</P>
<P>
Просьба детально описать, какая именно программа не работает, и какие
симптомы вы наблюдали! Нам доводилось получать много отчетов об ошибках,
где просто утверждалось, что "система не работает", - такие отчеты не
давали  никакой информации о характере возможной проблемы.

</P>
<P>
Если программа сбоит, то всегда полезно выяснить:

</P>

<ul>
<LI>

Не вызвала ли данная программа ошибки сегментации (<code>core dump</code>)?

<LI>

Не забирает ли программа все ресурсы процессора? Проверьте с помощью
<code>top</code>. Дайте программе немного поработать - возможно, она занимается
сложными вычислениями.

<LI>

Если проблемы вызваны именно сервером <code>mysqld</code>, то можно ли выполнить
<code>mysqladmin -u root ping</code> или <code>mysqladmin -u root processlist</code>?

<LI>

Что сообщает клиентская программа (попробуйте  поработать, например, с
<code>mysql</code>) при попытке соединиться с MySQL? Происходит ли заклинивание
клиента? Выдает ли программа какой-нибудь вывод?
</ul>

<P>
При посылке отчета об ошибке необходимо придерживаться схемы, описанной в
этом руководстве (see section <A HREF="manual.ru_Introduction.html#Asking_questions">1.8.1.2  Как задавать вопросы и направлять сообщения об ошибках</A>).

</P>


<H2><A NAME="Common_errors" HREF="manual.ru_toc.html#Common_errors">A.2  Распространенные ошибки при использовании MySQL</A></H2>

<P>
<A NAME="IDX1722"></A>

</P>
<P>
В этом разделе перечислены некоторые ошибки, с которыми часто приходится
сталкиваться пользователям; дается описание этих ошибок и способы их
исправления.

</P>


<H3><A NAME="Error_Access_denied" HREF="manual.ru_toc.html#Error_Access_denied">A.2.1  Ошибка <code>Access denied</code></A></H3>

<P>
<A NAME="IDX1723"></A>
<A NAME="IDX1724"></A>
<A NAME="IDX1725"></A>

</P>
<P>
See section <A HREF="manual.ru_MySQL_Database_Administration.html#Access_denied">4.2.11  Причины появления ошибок <code>Access denied</code> ("в доступе отказано")</A>.
See section <A HREF="manual.ru_MySQL_Database_Administration.html#Privileges">4.2.6  Как работает система привилегий</A>.

</P>


<H3><A NAME="Gone_away" HREF="manual.ru_toc.html#Gone_away">A.2.2  Ошибка <code>MySQL server has gone away</code></A></H3>

<P>
Все изложенное в данном разделе относится также и к родственной ошибке
<code>Lost connection to server during query</code>.

</P>
<P>
Наиболее часто ошибка MySQL  server  has  gone  away возникает в
результате тайм-аута соединения и его закрытия сервером. По умолчанию
сервер закрывает соединение по прошествии 8 часов бездействия. Можно
изменить лимит времени, установив при запуске <code><code>mysqld</code></code>  переменную
<code>wait_timeout</code>.

</P>
<P>
Другой распространенной причиной получения ошибки MySQL  server  has  gone
away является выдача команды "закрытия" на соединении MySQL с последующей
попыткой выполнить запрос на закрытом соединении.

</P>
<P>
Если это получено в скрипте, то достаточно просто повторить запрос от
клиента, чтобы соединение автоматически восстановилось.

</P>
<P>
Обычно в этом случае выдаются следующие коды ошибки (какой из них вы
получите, зависит от ОС):

</P>
<TABLE BORDER WIDTH="100%">
<TR><TD><strong>Код ошибки</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>
<code>CR_SERVER_GONE_ERROR</code> </TD><TD> Клиент не может послать запрос серверу.
</TD></TR>
<TR><TD>
<code>CR_SERVER_LOST</code> </TD><TD> Клиент не получил ошибки при передаче запроса серверу, но
он не получил также полного ответа (или хоть какого-то ответа) на запрос.
</TD></TR>
</TABLE>

<P>
Ошибка будет также выдана, если кто-нибудь уничтожит выполняющийся поток
посредством <code>kill номерпотока</code>.

</P>
<P>
Проверить, что MySQL на ходу, можно, запустив <code>mysqladmin version</code> и изучив
время работы (<code>uptime</code>). Если проблема в аварийном завершении <code><code>mysqld</code></code>, то
необходимо сосредоточиться на поиске причины аварии. В этом случае следует
сначала проверить, не будет ли уничтожен MySQL снова при повторном задании
запроса (see section <A HREF="manual.ru_Problems.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>).

</P>
<P>
Эти ошибки будут также выдаваться при посылке серверу неверного или
слишком длинного запроса. Если <code><code>mysqld</code></code> получает неправильный или слишком
большой пакет, то сервер предполагает, что с клиентом что-то не так, и
закрывает соединение. Если необходимо выполнять объемные запросы
(например, при работе с большими столбцами типа <code>BLOB</code>), можно увеличить
предельный размер запроса, запустив <code><code>mysqld</code></code> с опцией <code>-O</code> 
<code>max_allowed_packet=#</code> (по умолчанию 1 Mб). Дополнительная память выделяется
по требованию, так что <code><code>mysqld</code></code> будет выделять больше памяти только в
случае, когда выдан большой запрос или когда <code><code>mysqld</code></code> должен возвратить
большую строку результата!

</P>
<P>
Вы также можете получить разрыв соединения, если вы отправили пакет больше
16Мб, если ваш клиент старше чем 4.0.8, а ваш сервер 4.0.8 или новее.

</P>
<P>
Если у вас возникнет желание сделать отчет об ошибке по этой проблеме, то
не забудьте включить в него следующие сведения:

</P>

<ul>
<LI>

Информацию о том, упал MySQL или нет (это можно определить по файлу
<code>hostname.err</code> (see section <A HREF="manual.ru_Problems.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>).

<LI>

Если определенный запрос уничтожает <code>mysqld</code>, а используемые в нем
таблицы перед выполнением запроса проверялись с помощью <code>CHECK TABLE</code>,
то желательно составить контрольный тест (see section <A HREF="manual.ru_Porting.html#Reproduceable_test_case">E.1.6  Создание контрольного примера при повреждении таблиц</A>).

<LI>

Значение переменной <code>wait_timeout</code> в сервере (это значение выдает
<code>mysqladmin variables</code>).

<LI>

Информацию о том, пробовали ли вы запускать <code>mysqld</code> с <code>--log</code> и
проверять, появляется ли выданный запрос в журнале.
</ul>

<P>
Обращайтесь к разделу See section <A HREF="manual.ru_Introduction.html#Asking_questions">1.8.1.2  Как задавать вопросы и направлять сообщения об ошибках</A>.

</P>


<H3><A NAME="Can_not_connect_to_server" HREF="manual.ru_toc.html#Can_not_connect_to_server">A.2.3  Ошибка <code>Can't connect to [local] MySQL server</code></A></H3>

<P>
Клиент MySQL на Unix может соединиться с сервером <code>mysqld</code> двумя различными
способами: используя либо Unix-сокеты, когда соединение происходит через
файл в файловой системе (по умолчанию <tt>`/tmp/mysqld.sock'</tt>), либо TCP/IP с
соединением через номер порта. Unix-сокеты обеспечивают большую скорость,
чем TCP/IP, но могут применяться только при соединении с сервером на том
же компьютере. Unix-сокеты используются, если не задано имя хоста или если
задано специальное имя <code>localhost</code>.

</P>
<P>
В Windows, если сервер <code>mysqld</code> выполняется в 9x/Me, возможно соединение
только через TCP/IP. Если сервер работает на NT/2000/XP и <code>mysqld</code> запущен с
<code>--enable-named-pipe</code>, то можно также устанавливать соединение с помощью
именованных каналов. Имя именованного канала - MySQL. Если имя хоста не
указано при соединении с <code>mysqld</code>, то клиент MySQL сначала попробует
подключиться к именованному каналу, а если этого сделать не удастся, то к
порту TCP/IP. Можно предписать использование именованных каналов в
Windows, используя <code>.</code> в качестве имени хоста.

</P>
<P>
Ошибка <code>(2002) Can't connect to ...</code> обычно говорит о том, что MySQL не
запущен на данной системе или что при попытке соединиться с сервером
<code>mysqld</code> используется неверный сокет-файл или порт TCP/IP.

</P>
<P>
Для начала проверьте (с помощью <code>ps</code> или <code>диспетчера задач</code> в Windows),
выполняется ли на сервере процесс с именем <code>mysqld</code>! Если процесса <code>mysqld</code>
нет, то его необходимо запустить (see section <A HREF="manual.ru_Installing.html#Starting_server">2.4.2  Проблемы при запуске сервера MySQL</A>).

</P>
<P>
Если процесс <code>mysqld</code> выполняется, то можно проверить сервер, пробуя
использовать следующие различные соединения (конечно, номер порта и путь
сокета для вашей конфигурации могут быть другими):

</P>

<pre>
shell&#62; mysqladmin version
shell&#62; mysqladmin variables
shell&#62; mysqladmin -h `hostname` version variables
shell&#62; mysqladmin -h `hostname` --port=3306 version
shell&#62; mysqladmin -h 'ip for your host' version
shell&#62; mysqladmin --protocol=socket --socket=/tmp/mysql.sock version
</pre>

<P>
Обратите внимание на то, что для <code>hostname</code> используются обратные кавычки
вместо прямых; это задает подстановку вывода <code>hostname</code> (т.е. текущего имени
хоста) в команду <code>mysqladmin</code>.

</P>
<P>
Ниже приводится несколько причин, которые могут вызывать ошибку <code>Can't 
connect to local MySQL server</code>:

</P>

<ul>
<LI>

<code>mysqld</code> не выполняется.

<LI>

Сервер запущен на системе, использующей MIT-потоки. При работе на
системе, в которой отсутствуют "родные" потоки, <code>mysqld</code> использует пакет
<code>MIT-pthreads</code> (see section <A HREF="manual.ru_Installing.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>). Однако не
во всех версиях MIT-потоков поддерживаются Unix-сокеты. В системе без
поддержки сокетов при соединении с сервером всегда необходимо явно
указывать имя хоста. Попробуйте проверить соединение с сервером с помощью
следующей команды:


<pre>
shell&#62; mysqladmin -h `hostname` version
</pre>

<LI>

Кто-либо удалил Unix-сокет, используемый <code>mysqld</code> (по умолчанию
<tt>`/tmp/mysqld.sock'</tt>). Возможно, есть задание <code>cron</code>, которое удаляет сокет
MySQL (например, задание, удаляющее старые файлы в каталоге <tt>`/tmp'</tt>). В таком
случае всегда можно выполнить <code>mysqladmin version</code> и проверить,
действительно ли существует сокет, который используется <code>mysqladmin</code>.
Решение здесь заключается в следующем: можно либо изменить задание cron с
тем, чтобы оно не удаляло <tt>`mysqld.sock'</tt>, либо поместить сокет в каком-нибудь
другом месте (see section <A HREF="manual.ru_Problems.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A>).

<LI>

Сервер <code>mysqld</code> запущен с опцией <code>--socket=/path/to/socket</code>. Если путь к
сокету для сервера был изменен, то необходимо уведомить о новом пути и
клиентов MySQL. Это можно сделать, передав клиенту путь к сокету в
качестве аргумента. see section <A HREF="manual.ru_Problems.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A>.

<LI>

Используется Linux, и один из потоков аварийно завершился (<code>core dump</code>). В
этом случае, перед тем как заново запустить MySQL, необходимо уничтожить
все остальные потоки <code>mysqld</code> (например, с помощью сценария <code>mysql_zap</code>).
Обращайтесь к разделу See section <A HREF="manual.ru_Problems.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>.

<LI>

Возможно, пользователь, от которого запущен MySQL-сервер, не имеет
привилегий чтения и записи для каталога, содержащего сокет-файл, либо
для самого сокет-файла. В этом случае необходимо либо изменить
привилегии для каталога/файла, либо перезапустить <code>mysqld</code>, так чтобы
сервер использовал каталог, к которому пользователь имеет доступ.
</ul>

<P>
Если получено сообщение об ошибке <code>Can't connect to MySQL server on 
some_hostname</code>, то чтобы выяснить, в чем проблема, можно попробовать
выполнить следующие действия:

</P>

<ul>
<LI>

Проверить, запущен ли сервер, выполнив <code>telnet your-host-name 
tcp-ip-port-number</code>, и несколько раз нажать Enter. Если MySQL работает на
этом порту, то должен быть получен ответ, включающий номер версии
запущенного сервера. Если будет выдана ошибка вроде <code>telnet: Unable to 
connect to remote host: Connection refused</code>, то на указанном порту
сервер не работает.

<LI>

Попробуйте соединиться с демоном <code>mysqld</code> на локальной машине и проверьте
с помощью <code>mysqladmin variables</code>, какой порт TCP/IP сконфигурирован для
использования <code>mysqld</code> (переменная port).

<LI>

Проверьте, не запускается ли сервер <code>mysqld</code> с опцией <code>--skip-networking</code>.
</ul>



<H3><A NAME="Blocked_host" HREF="manual.ru_toc.html#Blocked_host">A.2.4  Ошибка <code>Host '...' is blocked</code></A></H3>

<P>
Ошибка, подобная следующей:

</P>

<pre>
Host 'hostname' is blocked because of many connection errors.
Unblock with 'mysqladmin flush-hosts'
</pre>

<P>
говорит о том, что от хоста <code>hostname</code> имело место большое количество
(<code>max_connect_errors</code>) прерванных посредине запросов на соединение к <code>mysqld</code>.
После <code>max_connect_errors</code> неудачных запросов <code>mysqld</code> делает предположение,
что что-то не так (может, атака от кракера), и блокирует последующие
соединения с узла до того момента, пока кто-нибудь не выполнит команду
<code>mysqladmin flush-hosts</code>.

</P>
<P>
По умолчанию <code>mysqld</code> блокирует хост после 10 ошибок соединения. Это
значение можно легко отрегулировать, запустив сервер следующим образом:

</P>

<pre>
shell&#62; safe_mysqld -O max_connect_errors=10000 &#38;
</pre>

<P>
Заметим, что если для некоторого хоста получено это сообщение об ошибке,
то следует сначала проверить, все ли в порядке с TCP/IP-соединениями от
этого хоста. Если TCP/IP-соединения не работают, то увеличивать значение
переменной <code>max_connect_errors</code> бесполезно!

</P>


<H3><A NAME="Too_many_connections" HREF="manual.ru_toc.html#Too_many_connections">A.2.5  Ошибка <code>Too many connections</code></A></H3>

<P>
Получение ошибки <code>Too many connections</code> при попытке соединиться с MySQL
означает, что уже есть <code>max_connections</code> клиентов, соединившихся с сервером
<code>mysqld</code>.

</P>
<P>
Если есть потребность в большем количестве соединений, чем задано по
умолчанию (100), то следует перезапустить <code>mysqld</code> с заданием большего
значения для переменной max_connections.

</P>
<P>
Заметим, что фактически <code>mysqld</code> разрешает соединяться (<code>max_connections</code>+1)
клиентам. Последнее соединение зарезервировано для пользователя с
привилегией <code>SUPER</code>. Если не наделять этой привилегией обычных пользователей
(они могут обойтись и без нее), то администратор, располагая этой
привилегией, может войти и использовать <code>SHOW PROCESSLIST</code> для выяснения
причин неполадок (see section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW_PROCESSLIST">4.5.6.6  <code>SHOW PROCESSLIST</code></A>).

</P>
<P>
Максимальное число соединений MySQL зависит от того, насколько хорошей
является библиотека потоков на данной платформе. Linux или Solaris должны
быть в состоянии поддерживать 500-1000 одновременных соединений, в
зависимости от количества имеющейся памяти и того, чем занимаются клиенты.

</P>


<H3><A NAME="Non-transactional_tables" HREF="manual.ru_toc.html#Non-transactional_tables">A.2.6  Ошибка <code>Some non-transactional changed tables couldn't be rolled back</code></A></H3>

<P>
<A NAME="IDX1726"></A>

</P>
<P>
Получение ошибки/предупреждения: <code>Warning: Some non-transactional changed
tables couldn't be rolled back</code> при попытке сделать <code>ROLLBACK</code> означает,
что для некоторых использованных в транзакции таблиц не поддерживаются
транзакции. Команда <code>ROLLBACK</code> на эти нетранзакционные таблицы не
подействует.

</P>
<P>
Наиболее типичный случай возникновения такой ошибки связан с попыткой
создать таблицу, тип которой не поддерживается бинарником <code>mysqld</code>. Если
<code>mysqld</code> не поддерживает тип таблиц (или тип таблиц отключен опцией при
запуске), то сервер создаст таблицу с типом, наиболее близким к
запрошенному (скорее всего, <code>MyISAM</code>).

</P>
<P>
Чтобы проверить тип таблицы, следует выполнить:

</P>
<P>
<code>SHOW TABLE STATUS LIKE 'table_name'</code>. See section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW_TABLE_STATUS">4.5.6.2  <code>SHOW TABLE STATUS</code></A>.

</P>
<P>
Можно проверить, какие расширения поддерживает исполняемый файл <code>mysqld</code>,
выполнив:

</P>
<P>
<code>show variables like 'have_%'</code>. See section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.

</P>


<H3><A NAME="Out_of_memory" HREF="manual.ru_toc.html#Out_of_memory">A.2.7  Ошибка <code>Out of memory</code></A></H3>

<P>
По выданному запросу может быть получена ошибка следующего вида:

</P>
<P>
<code>mysql: Out of memory at line 42, 'malloc.c'</code>

</P>
<P>
<code>mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)</code>

</P>
<P>
<code>ERROR 2008: MySQL client ran out of memory</code>

</P>
<P>
Как видим, в ней есть ссылка на MySQL-клиент <code>mysql</code>. Причина этой ошибки в
том, что клиенту просто не хватает памяти для размещения всего результата.

</P>
<P>
Чтобы устранить данную проблему, сначала проверьте правильность запроса.
Действительно ли есть необходимость в том, чтобы запрос возвращал так
много строк? Если да, то можно использовать <code>mysql --quick</code>, где для
извлечения результирующего множества применяется <code>mysql_use_result()</code>. При
этом уменьшается загрузка клиента (но увеличивается загрузка сервера).

</P>


<H3><A NAME="Packet_too_large" HREF="manual.ru_toc.html#Packet_too_large">A.2.8  Ошибка <code>Packet too large</code></A></H3>

<P>
Когда клиент MySQL или сервер <code>mysqld</code> получают пакет с размерами,
превышающими <code>max_allowed_packet</code> байтов, программа выдает ошибку <code>Packet 
too large</code> и закрывает соединение.

</P>
<P>
В MySQL 3.23 размер самого большого возможного пакета составляет 16 Mб
(из-за ограничений клиент-серверного протокола). В MySQL 4.0.1 и выше
размер пакета ограничивается только количеством имеющейся на сервере
памяти (вплоть до теоретического максимума в 2 Гб).

</P>
<P>
Коммуникационный пакет - это одна команда SQL, посылаемая серверу, или
одна строка, посылаемая клиенту.

</P>
<P>
Когда клиент MySQL или сервер <code>mysqld</code> получают пакет, размеры которого
превышают <code>max_allowed_packet</code> байтов, программа выдает ошибку <code>Packet too 
large</code> и закрывает соединение. Если коммуникационный пакет слишком велик,
то в некоторых клиентах может быть выдана ошибка <code>Lost connection to 
MySQL server during query</code>.

</P>
<P>
Отметим, что и клиент, и сервер имеют свои собственные переменные
<code>max_allowed_packet</code>. Если требуется обрабатывать большие пакеты, то эту
переменную необходимо увеличить как для клиента, так и для сервера.

</P>
<P>
Увеличение переменной не опасно, поскольку память выделяется только при
необходимости; эта переменная скорее является мерой предосторожности для
"отлавливания" неправильных пакетов между клиентом и сервером, а также
для того, чтобы предупредить ситуацию нехватки памяти, вследствие
случайного использования больших пакетов.

</P>
<P>
Если используется клиент <code>mysql</code>, то можно задать больший буфер, запустив
клиент посредством <code>mysql --set-variable=max_allowed_packet=8M</code>. Для других
клиентов существуют собственные методы установки этой переменной.
Обратите внимание, что начиная с 4.0 использование <code>--set-variable</code> не
рекомендуется, используйте просто <code>--max-allowed-packet=8M</code>.

</P>
<P>
Для установки <code>max_allowed_packet</code> большего размера в <code>mysqld</code> можно также
использовать файл опций. Например, если в таблице предполагается хранить
значение типа <code>MEDIUMBLOB</code> максимальной длины, то нужно запускать сервер с
опцией <code>set-variable=max_allowed_packet=16M</code>.

</P>
<P>
При использовании больших пакетов могут также возникать непредсказуемые
проблемы, если вы работаете с большими значениями типа <code>BLOB</code>, и <code>mysqld</code> не
был предоставлен доступ к достаточному объему памяти для обработки
запроса. Если есть подозрение, что дело в этом, попробуйте добавить <code>ulimit
-d 256000</code> в начале скрипта <code>safe_mysqld</code> и перезапустить <code>mysqld</code>.

</P>


<H3><A NAME="Communication_errors" HREF="manual.ru_toc.html#Communication_errors">A.2.9  Коммуникационные ошибки / Оборванные соединения</A></H3>

<P>
<A NAME="IDX1727"></A>
<A NAME="IDX1728"></A>
<A NAME="IDX1729"></A>

</P>
<P>
Начиная с MySQL 3.23.40 ошибка <code>Aborted connection</code> выдается только в
случае, если <code>mysqld</code> запущен с <code>--warnings</code>.

</P>
<P>
В журнале ошибок могут присутствовать ошибки наподобие этой:

</P>
<P>
<code>010301 14:38:23 Aborted connection 854 to db: 'users' user: 'josh'</code>

</P>
<P>
(see section <A HREF="manual.ru_MySQL_Database_Administration.html#Error_log">4.9.1  Журнал ошибок</A>).

</P>
<P>
Такие ошибки сигнализируют об одной из следующих ситуаций:

</P>

<ul>
<LI>

Клиентская программа не выполнила <code>mysql_close()</code> перед выходом.

<LI>

Клиент бездействовал на протяжении более чем <code>wait_timeout</code> или
<code>interactive_timeout</code> (see section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>).

<LI>

Клиентская программа внезапно завершилась посреди передачи.
</ul>

<P>
В подобных ситуациях увеличивается значение переменной сервера
<code>Aborted_clients</code>.

</P>
<P>
Значение переменной сервера <code>Aborted_connects</code> увеличивается в следующих
случаях:

</P>

<ul>
<LI>

Когда пакет соединения содержит неверную информацию.

<LI>

Когда пользователь не имеет привилегий для соединения с базой данных.

<LI>

Когда пользователь использует неверный пароль.

<LI>

Когда на получение пакета соединения уходит более <code>connect_timeout</code>
секунд. See section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.
</ul>

<P>
Обратите внимание: все перечисленное выше может свидетельствовать о
попытке взлома базы данных!

</P>
<P>
Ниже перечислены другие причины проблем, которые могут возникнуть с
оборванными клиентами или разорванными соединениями.

</P>

<ul>
<LI>

Использование как полудуплексного, так и полного дуплексного
Ethernet-протокола под Linux. Данная ошибка присутствует во многих
Linux-драйверах Ethernet. Выполните тест на данную ошибку - для этого
следует передать очень большой файл через ftp-соединение между этими двумя
машинами. Если передача проходит в режиме всплеск-пауза-всплеск-пауза ...,
то можно констатировать наличие дуплексного синдрома Linux. Единственное
решение проблемы - отключить как полу-, так и полнодуплексную передачу на
концентраторах и коммутаторах.

<LI>

Некоторая проблема с библиотекой потоков, вызывающая прерывания при
чтении.

<LI>

"Криво" сконфигурированный TCP/IP.

<LI>

Дефектные Ethernet-карты, концентраторы, коммутаторы или кабели... Такие
проблемы можно как следует диагностировать только путем замены
оборудования.

<LI>

<code>max_allowed_packet</code> слишком мала, или запросам требуется памяти больше,
чем было выделено для <code>mysqld</code> (see section <A HREF="manual.ru_Problems.html#Packet_too_large">A.2.8  Ошибка <code>Packet too large</code></A>).
</ul>



<H3><A NAME="Full_table" HREF="manual.ru_toc.html#Full_table">A.2.10  Ошибка <code>The table is full</code></A></H3>

<P>
<A NAME="IDX1730"></A>

</P>
<P>
Существует несколько случаев, когда выдается эта ошибка:

</P>

<ul>
<LI>

Используется старая версия MySQL (до 3.23.0), а размещенная в памяти
временная таблица становится больше, чем <code>tmp_table_size</code> байтов. Для
решения этой проблемы можно использовать опцию <code>-O tmp_table_size=#</code>,
чтобы <code>mysqld</code> увеличил размер временных таблиц, или опцию SQL 
<code>SQL_BIG_TABLES</code>, перед тем как выдать сомнительный запрос (see section <A HREF="manual.ru_MySQL_Optimisation.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>). 
Можно также запускать <code>mysqld</code> с опцией <code>--big-tables</code> -
эффект здесь будет таким же, как и от использования <code>SQL_BIG_TABLES</code> для
всех запросов. В версии MySQL 3.23 размещенные в памяти временные
таблицы после того, как размер таблицы превысит <code>tmp_table_size</code>,
автоматически преобразуются в расположенные на диске таблицы типа
<code>MyISAM</code>.

<LI>

Используются таблицы <code>InnoDB</code> и исчерпалось место в табличном
пространстве <code>InnoDB</code>. В таком случае следует увеличить табличное
пространство <code>InnoDB</code>.

<LI>

Используются таблицы <code>ISAM</code> или <code>MyISAM</code> в операционной системе, которая
поддерживает файлы размером до 2 Гб, и файл данных или индексный файл
достигли этого предела.

<LI>

Используются таблицы <code>MyISAM</code>, и размер требуемых данных или индекса
превышает тот, который предусматривался MySQL при выделении указателей
(если <code>MAX_ROWS</code> не указано в <code>CREATE TABLE</code>, MySQL выделяет указатели,
предусматривающие размещение только 4 Гб данных). Проверить
максимальные размеры данных/индекса можно посредством


<pre>
SHOW TABLE STATUS FROM database LIKE 'table_name';
</pre>

или с помощью <code>myisamchk -dv база_данных/таблица</code>. Если проблема связана с
указателями, то это можно исправить с помощью команды наподобие следующей:


<pre>
ALTER TABLE table_name MAX_ROWS=1000000000 AVG_ROW_LENGTH=nnn;
</pre>

Указывать <code>AVG_ROW_LENGTH</code> нужно только для таблиц с полями типа <code>BLOB/TEXT</code>,
поскольку в этом случае MySQL не может оптимизировать требуемое
пространство, исходя только из количества строк.
</ul>



<H3><A NAME="Cannot_create" HREF="manual.ru_toc.html#Cannot_create">A.2.11  Ошибка <code>Can't create/write to file</code></A></H3>

<P>
Получение для некоторых запросов ошибки вида:

</P>
<P>
<code>Can't create/write to file '\\sqla3fe_0.ism'</code>.

</P>
<P>
означает, что MySQL не может создать в заданном временном каталоге
временный файл для результирующего набора (приведенное сообщение об ошибке
типично для Windows, примерно такой же вид имеет сообщение об ошибке
Unix). Чтобы решить проблему, запустите <code>mysqld</code> с <code>--tmpdir=path</code> или
добавьте в своем файле опций:

</P>

<pre>
[mysqld]
tmpdir=C:/temp
</pre>

<P>
исходя из предположения, что каталог <tt>`c:\\temp'</tt> существует 
(see section <A HREF="manual.ru_MySQL_Database_Administration.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).

</P>
<P>
Проверьте также код полученной ошибки с помощью perror. Одной из причин
также может быть ошибка переполнения диска;

</P>

<pre>
shell&#62; perror 28
Error code 28: No space left on device
</pre>



<H3><A NAME="Commands_out_of_sync" HREF="manual.ru_toc.html#Commands_out_of_sync">A.2.12  Ошибка в клиенте <code>Commands out of sync</code></A></H3>

<P>
<A NAME="IDX1731"></A>

</P>
<P>
Если получена ошибка <code>Commands out of sync; you can't run this 
command now</code> в клиентском коде, то клиентские функции вызываются в
неправильном порядке!

</P>
<P>
Это может произойти, например, если используется <code>mysql_use_result()</code> и
делается попытка выполнить новый запрос до того, как вызвана
<code>mysql_free_result()</code>, или если клиент пытается выполнить два возвращающих
данные запроса без обращения к <code>mysql_use_result()</code> либо
<code>mysql_store_result()</code> в промежутке между ними.

</P>


<H3><A NAME="Ignoring_user" HREF="manual.ru_toc.html#Ignoring_user">A.2.13  Ошибка <code>Ignoring user</code></A></H3>

<P>
Получение следующей ошибки:

</P>
<P>
<code>Found wrong password for user: 'some_user@some_host'; ignoring user</code>

</P>
<P>
означает, что при запуске <code>mysqld</code> или при перезагрузке таблиц привилегий
сервер нашел в таблице <code>user</code> запись с неправильным паролем и в результате
запись просто игнорируется системой привилегий.

</P>
<P>
Причины проблемы и способы ее решения могут быть следующими:

</P>

<ul>
<LI>

Возможно, работает новая версия <code>mysqld</code> со старой таблицей user. Это
можно проверить путем выполнения <code>mysqlshow mysql user</code>, чтобы
посмотреть, короче ли поле пароля, чем 16 символов. Если это так, то
положение можно исправить, запустив сценарий
<tt>`scripts/add_long_password'</tt>.

<LI>

У пользователя старый пароль (длиной в 8 символов), а <code>mysqld</code> запущен
без опции <code>--old-protocol</code>. Обновите данные пользователя в таблице user,
задав новый пароль, или перезапустите <code>mysqld</code> с <code>--old-protocol</code>.

<LI>

Пароль был установлен в таблице user без применения функции
<code>PASSWORD()</code>. Воспользуйтесь <code>mysql</code> для обновления пароля пользователя в
таблице <code>user</code>. Позаботьтесь о том, чтобы была использована функция
<code>PASSWORD()</code>:


<pre>
mysql&#62; UPDATE user SET password=PASSWORD('your password')
    -&#62;             WHERE user='XXX';
</pre>

</ul>



<H3><A NAME="Cannot_find_table" HREF="manual.ru_toc.html#Cannot_find_table">A.2.14  Ошибка <code>Table 'xxx' doesn't exist</code></A></H3>

<P>
Получение ошибки <code>Table 'xxx' doesn't exist</code> или <code>Can't find file: 'xxx'
(errno: 2)</code>, означает, что в текущей базе данных не существует таблицы с
именем <code>xxx</code>.

</P>
<P>
Обратите внимание: поскольку в MySQL для хранения баз данных и таблиц
используются каталоги и файлы, то имена баз данных и каталогов <strong>являются</strong>
зависимыми от регистра символов! (Под Windows имена баз данных и таблиц не
зависят от регистра символов, но для всех ссылок на заданную таблицу в
пределах запроса должен использоваться одинаковый регистр!)

</P>
<P>
Проверить, какие таблицы имеются в текущей базе данных, можно с помощью
<code>SHOW TABLES</code>. see section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>.

</P>


<H3><A NAME="Cannot_initialize_character_set" HREF="manual.ru_toc.html#Cannot_initialize_character_set">A.2.15  Ошибка <code>Can't initialize character set xxx</code></A></H3>

<P>
<A NAME="IDX1732"></A>

</P>
<P>
Получение ошибки наподобие:

</P>
<P>
<code>MySQL Connection Failed: Can't initialize character set xxx</code>

</P>
<P>
Означает, что имеется одна из следующих ситуаций:

</P>

<ul>
<LI>

Кодировка является многобайтовой и не поддерживается клиентом. В этом
случае необходимо перекомпилировать клиент с <code>--with-charset=xxx</code> или с
<code>--with-extra-charsets=xxx</code> (see section <A HREF="manual.ru_Installing.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>).
Весь стандартный бинарный код MySQL откомпилирован с
<code>--with-extra-character-sets=complex</code>, что обеспечивает поддержку всех
многобайтовых кодировок (see section <A HREF="manual.ru_MySQL_Database_Administration.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>).

<LI>

Кодировка является простой кодировкой, не скомпилированной в <code>mysqld</code>, и
файлы определения кодировки находятся не там, где рассчитывает их
найти клиент. В этом случае необходимо:


<ul>
<LI>

Перекомпилировать клиент с поддержкой этой кодировки (see section <A HREF="manual.ru_Installing.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>).

<LI>

Указать клиенту, где расположены файлы определения кодировки. Для многих
клиентов это можно сделать с помощью опции
<code>--character-sets-dir=path-to-charset-dir</code>.

<LI>

Скопировать файлы определения кодировки туда, где, по мнению клиента,
они должны находиться.
</ul>

</ul>



<H3><A NAME="Not_enough_file_handles" HREF="manual.ru_toc.html#Not_enough_file_handles">A.2.16  Не найден файл (<code>File not found</code>)</A></H3>

<P>
Получение от MySQL <code>ERROR '...' not found (errno: 23), Can't open file: ...
(errno: 24)</code>, или любой другой ошибки с номером 23 или 24 означает, что
для MySQL выделено недостаточно файловых дескрипторов. Можно использовать
утилиту perror для получения описания ошибки с определенным номером:

</P>

<pre>
shell&#62; perror 23
File table overflow
shell&#62; perror 24
Too many open files
shell&#62; perror 11
Resource temporarily unavailable
</pre>

<P>
Проблема здесь в том, что <code>mysqld</code> пытается одновременно держать открытыми
слишком много файлов. Можно либо указать <code>mysqld</code> не открывать так много
файлов одновременно, либо увеличить количество файловых дескрипторов,
доступных <code>mysqld</code>.

</P>
<P>
Чтобы предписать <code>mysqld</code> держать одновременно открытыми меньше файлов,
можно уменьшить табличный кэш, задав <code>safe_mysqld</code> опцию <code>-O table_cache=32</code>
(значение по умолчанию 64). Уменьшение значения <code>max_connections</code> также
уменьшит количество открытых файлов (по умолчанию значение переменной 90).

</P>
<P>
Чтобы изменить число доступных <code>mysqld</code> файловых дескрипторов, можно
использовать опцию <code>--open-files-limit=#</code> в <code>safe_mysqld</code> или опцию 
<code>-O open-files-limit=#</code> в <code>mysqld</code> (see section <A HREF="manual.ru_MySQL_Database_Administration.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>). Проще всего это
сделать путем добавления опции в файл опций (see section <A HREF="manual.ru_MySQL_Database_Administration.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).
Если используется ранняя версия <code>mysqld</code>, не поддерживающая эту
возможность, можно отредактировать скрипт <code>safe_mysqld</code>. В скрипте есть
закомментированная строка <code>ulimit -n 256</code>; можно, убрав символ <samp>`#'</samp>,
раскомментировать эту строку и, заменив значение 256 другим, повлиять на
количество доступных <code>mysqld</code> файловых дескрипторов.

</P>
<P>
При помощи <code>ulimit</code> (и <code>open-files-limit</code>) можно увеличить количество файловых
дескрипторов только до предела, установленного в операционной системе.
Существует также "жесткий" предел, который может быть переопределен
только при запуске <code>safe_mysqld</code> или <code>mysqld</code> от имени пользователя <code>root</code> (но
помните, что в этом случае также следует использовать опцию <code>--user=...</code>).
Если необходимо увеличить предел ОС по количеству доступных отдельному
процессу файловых дескрипторов, обращайтесь к документации по своей
операционной системе.

</P>
<P>
Обратите внимание: при использовании <code>tcsh ulimit</code> работать не будет! Кроме
того, <code>tcsh</code> будет сообщать неверные значения при запросе текущих пределов!
В этом случае необходимо запускать <code>safe_mysqld</code> с использованием <code>sh</code>!

</P>


<H2><A NAME="Installation_Issues" HREF="manual.ru_toc.html#Installation_Issues">A.3  Вопросы, связанные с инсталляцией</A></H2>



<H3><A NAME="Link_errors" HREF="manual.ru_toc.html#Link_errors">A.3.1  Проблемы при линковании с клиентской библиотекой MySQL</A></H3>

<P>
<A NAME="IDX1733"></A>
<A NAME="IDX1734"></A>
<A NAME="IDX1735"></A>

</P>
<P>
Если при линковании программы получены ошибки неразрешенных ссылок на
символы, имена которых начинаются с <code>mysql_</code>, подобные следующим:

</P>


<pre>
/tmp/ccFKsdPa.o: In function `main':
/tmp/ccFKsdPa.o(.text+0xb): undefined reference to `mysql_init'
/tmp/ccFKsdPa.o(.text+0x31): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x57): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x69): undefined reference to `mysql_error'
/tmp/ccFKsdPa.o(.text+0x9a): undefined reference to `mysql_close'
</pre>

<P>
то их можно устранить, добавив <code>-Lpath-to-the-mysql-library -lmysqlclient</code> 
<strong>в самом конце</strong> используемой команды линкования.

</P>
<P>
Если выдаются ошибки <code>undefined reference</code> для функции <code>uncompress</code> или
<code>compress</code>, добавьте <strong>в самом конце</strong> команды линкования <code>-lz</code> и повторите
попытку!

</P>
<P>
Если получены ошибки <code>undefined reference</code> для функций, которые должны
присутствовать в системе, таких как <code>connect</code>, то сверьтесь по странице
руководства для данной функции, какие библиотеки необходимо добавить в
команде линкования!

</P>
<P>
Получение ошибок <code>undefined reference</code> для функций, отсутствующих в
используемой системе, наподобие следующего:

</P>

<pre>
mf_format.o(.text+0x201): undefined reference to `__lxstat'
</pre>

<P>
обычно означает, что библиотека скомпилирована в системе, которая не на
100% совместима с системой пользователя. В этом случае необходимо
загрузить последнюю поставку с исходными текстами MySQL и откомпилировать
библиотеку самостоятельно (see section <A HREF="manual.ru_Installing.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>).

</P>
<P>
Если при попытке выполнить программу выдаются ошибки о ненайденных
символах, начинающихся с <code>mysql_</code>, или о том, что не удается найти
библиотеку <code>mysqlclient</code>, то это означает, что система не может найти
динамической библиотеки <tt>`libmysqlclient.so'</tt>.

</P>
<P>
Чтобы исправить это, необходимо предписать системе проводить поиск
динамических библиотек в каталоге с клиентской библиотекой MySQL. Это
можно сделать одним из следующих способов:

</P>

<ul>
<LI>

Добавить в переменную окружения <code>LD_LIBRARY_PATH</code> путь к каталогу,
содержащему <tt>`libmysqlclient.so'</tt>.

<LI>

Добавить в переменную окружения <code>LD_LIBRARY</code> путь к каталогу, содержащему
<tt>`libmysqlclient.so'</tt>.

<LI>

Скопировать <tt>`libmysqlclient.so'</tt> в каталог, просматриваемый системой при
поиске библиотек, таких как <tt>`/lib'</tt>, и обновить информацию о распределенных
библиотеках, выполнив <code>ldconfig</code>.

</ul>

<P>
Другой способ решения этой проблемы заключается в статическом линковании
программы с использованием <code>-static</code>, или в удалении динамических библиотек
MySQL до линкования своего кода. Во втором случае необходимо
удостовериться, что динамические библиотеки не используются другими
программами!

</P>


<H3><A NAME="Changing_MySQL_user" HREF="manual.ru_toc.html#Changing_MySQL_user">A.3.2  Запуск MySQL от обычного пользователя</A></H3>

<P>
<A NAME="IDX1736"></A>
<A NAME="IDX1737"></A>

</P>
<P>
Сервер <code>mysqld</code> может запускаться и работать от любого пользователя. Чтобы
настроить <code>mysqld</code> для работы под Unix-пользователем <code>user_name</code>, необходимо
выполнить следующие действия:

</P>

<ol>
<LI>

Если сервер работает, остановите его (используйте <code>mysqladmin 
shutdown</code>).

<LI>

Измените каталоги и файлы баз данных так, чтобы <code>user_name</code> имел
привилегии для чтения и записи файлов в этих каталогах (возможно, это
нужно будет делать из Unix-аккаунта <code>root</code>):


<pre>
shell&#62; chown -R user_name /path/to/mysql/datadir
</pre>

Если среди каталогов или файлов в каталоге данных MySQL присутствуют
символические ссылки, то нужно будет также перейти по этим ссылкам и
изменить каталоги и файлы, на которые они указывают. <code>chown -R</code> может не
отработать символических ссылок.

<LI>

Запустите сервер из аккаунта <code>user_name</code> или, если у вас MySQL 3.22 и
выше, запустите <code>mysqld</code> из Unix-аккаунта <code>root</code> и используйте опцию
<code>--user=user_name</code>. <code>mysqld</code> переключится на выполнение в контексте
Unix-пользователя <code>user_name</code> до того, как начнет обслуживать запросы на
соединение.

<LI>

Чтобы запускать сервер от имени данного пользователя автоматически
в ходе загрузки системы, добавьте строку user, указывающую имя
пользователя, в группе <code>[mysqld]</code> файла опций <tt>`/etc/my.cnf'</tt> или файла
опций <tt>`my.cnf'</tt> из каталога данных сервера. Например:


<pre>
[mysqld]
user=user_name
</pre>

</ol>

<P>
К этому моменту процесс <code>mysqld</code> должен без помех работать под
Unix-пользователем <code>user_name</code>. Однако содержимое таблиц привилегий не
изменяется. По умолчанию (сразу после выполнения скрипта инсталляции
таблиц привилегий <code>mysql_install_db</code>) MySQL-пользователь <code>root</code> является
единственным пользователем с правами на доступ к базе данных <code>mysql</code>, а
также на создание и удаление баз данных. Если вы не меняли этих
полномочий, они по-прежнему действительны. То, что вы вошли в систему как
Unix-пользователь, отличный от <code>root</code>, не может вам помешать получить доступ
к MySQL в качестве MySQL-пользователя root; просто задайте клиентской
программе опцию <code>-u root</code>.

</P>
<P>
Отметим, что работа с MySQL в качестве MySQL-пользователя <code>root</code> посредством
указания <code>-u root</code> в командной строке <strong>не имеет ничего общего</strong> с выполнением
MySQL под Unix-пользователем <code>root</code>, или вообще под каким бы то ни было
Unix-пользователем. Привилегии доступа и имена пользователей MySQL никак
не связаны с именами Unix-пользователей. Единственная связь с именами
Unix-пользователей заключается в том, что если при запуске клиентской
программы не задана опция <code>-u</code>, то клиент попытается соединиться, используя
в качестве имени MySQL-пользователя имя Unix-аккаунта.

</P>
<P>
Если Unix-сервер не слишком хорошо защищен или не нуждается в повышенных
мерах безопасности, следует как минимум установить в таблицах привилегий
пароль для MySQL-<code>пользователя</code> root. В противном случае любой пользователь
с аккаунтом на данной машине сможет запустить <code>mysql -u root db_name</code> и
делать в MySQL все, что ему заблагорассудится.

</P>


<H3><A NAME="File_permissions" HREF="manual.ru_toc.html#File_permissions">A.3.3  Проблемы с правами доступа к файлам</A></H3>

<P>
<A NAME="IDX1738"></A>
<A NAME="IDX1739"></A>
<A NAME="IDX1740"></A>

</P>
<P>
Если существуют проблемы с правами доступа к файлам, например, если <code>mysql</code>
при создании таблицы выдает следующее сообщение об ошибке:

</P>
<P>
<code>ERROR: Can't find file: 'path/with/filename.frm' (Errcode: 13)</code>

</P>
<P>
<A NAME="IDX1741"></A>
<A NAME="IDX1742"></A>

</P>
<P>
то, возможно, при запуске сервера <code>mysqld</code> неправильно устанавливается
переменная окружения <code>UMASK</code>. По умолчанию значение  <code>umask 0660</code>. Его можно
изменить, запуская <code>safe_mysqld</code> следующим образом:

</P>

<pre>
shell&#62; UMASK=384 # = 600 in octal
shell&#62; export UMASK
shell&#62; /path/to/safe_mysqld &#38;
</pre>

<P>
<A NAME="IDX1743"></A>
<A NAME="IDX1744"></A>

</P>
<P>
По умолчанию MySQL создает каталоги баз данных и RAID-каталоги с правами
доступа <code>0700</code>. Такое поведение можно изменить, установив переменную
<code>UMASK_DIR</code>. Если установить эту переменную, то при создании новых каталогов
используется комбинация <code>UMASK</code> и <code>UMASK_DIR</code>. Например, если требуется, чтобы
доступ ко всем новым каталогам получала группа, то можно выполнить:

</P>

<pre>
shell&#62; UMASK_DIR=504 # = 770 in octal
shell&#62; export UMASK_DIR
shell&#62; /path/to/safe_mysqld &#38;
</pre>

<P>
В версии MySQL 3.23.25 и выше MySQL предполагает, что значения для <code>UMASK</code> и
<code>UMASK_DIR</code>, начинающиеся с нуля, восьмеричные.

</P>
<P>
see section <A HREF="manual.ru_Environment_variables.html#Environment_variables">F  Переменные окружения</A>.

</P>


<H2><A NAME="Administration_Issues" HREF="manual.ru_toc.html#Administration_Issues">A.4  Вопросы, связанные с администрированием</A></H2>



<H3><A NAME="Crashing" HREF="manual.ru_toc.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A></H3>

<P>
<A NAME="IDX1745"></A>

</P>
<P>
Перед официальным выпуском все версии MySQL тестируются на многих
платформах. Это не означает, что в MySQL совсем нет ошибок, но если они и
есть, то мало, и их не так просто отыскать. В любом случае, столкнувшись с
какой-либо проблемой, всегда полезно попытаться точно определить, что
вызывает аварию системы, - тогда шансы, что проблема будет устранена в
скором времени, станут значительно выше.

</P>
<P>
Сначала надо попробовать локализовать проблему. Определите, что
происходит: то ли демон <code>mysqld</code> прекращает работу, то ли проблема связана с
клиентом. Узнать, сколько времени сервер <code>mysqld</code> уже работает, можно,
выполнив <code>mysqladmin version</code>. Если <code>mysqld</code> прекратил выполнение, то для
выяснения причин можно изучить файл  <tt>`mysql-data-directory/`hostname`.err'</tt>
(see section <A HREF="manual.ru_MySQL_Database_Administration.html#Error_log">4.9.1  Журнал ошибок</A>).

</P>
<P>
Причиной многих аварий MySQL являются поврежденные индексные файлы или
файлы данных. MySQL обновляет данные на диске, используя системный вызов
<code>write()</code>, после каждой команды SQL и до того, как клиент будет уведомлен о
результате (однако при выполнении с <code>delay_key_write</code> это не так: 
записываются только данные). Отсюда следует, что данные не пострадают даже
в случае аварийного завершения <code>mysqld</code>, поскольку ОС позаботится о том,
чтобы те данные, которые не сброшены, были записаны на диск. Можно
заставить MySQL сбрасывать все на диск после каждой SQL-команды, запустив
<code>mysqld</code> с <code>--flush</code>.

</P>
<P>
Все это означает, что обычно таблицы не должны повреждаться; исключение
составляют следующие случаи:

</P>

<ul>
<LI>

Кто-нибудь/что-нибудь убьет процесс <code>mysqld</code> или выключит машину посреди
операции обновления.

<LI>

Проявила себя ошибка в <code>mysqld</code>, вызывающая прекращение его выполнения
посреди операции обновления.

<LI>

Кто-нибудь работает с файлами данных или индексными файлами вне <code>mysqld</code> и
при этом не делает блокировку таблиц как следует.

<LI>

Если работает несколько серверов <code>mysqld</code> с одними данными на системе без
пристойной поддержки блокировок  файловой системы (обычно реализуется
демоном <code>lockd</code>) или если выполняется несколько серверов со <code>--skip-external-locking</code>

<LI>

Существует поврежденный индексный файл или файл данных, содержащий очень
неправильные данные, которые вводят в заблуждение <code>mysqld</code>.

<LI>

Проявила себя  в коде записи данных. Это маловероятно, но в общем случае
возможно. В этом случае можно попробовать изменить формат файла на
соответствующий другому обработчику баз данных, используя <code>ALTER TABLE</code> на
исправленной копии таблицы!
</ul>

<P>
Поскольку найти причину сбоя всегда непросто, сначала можно попробовать 
выяснить, что из того, что работает у других, вызывает аварии у вас.
Попытайтесь выполнить следующие действия:

</P>

<ul>
<LI>

Остановите демон <code>mysqld</code> с помощью <code>mysqladmin shutdown</code>, выполните
<code>myisamchk --silent --force */*.MYI</code> на всех таблицах и перезапустите
демон <code>mysqld</code>. Этим гарантируется безошибочность исходного состояния
(see section <A HREF="manual.ru_MySQL_Database_Administration.html#MySQL_Database_Administration">4  Администрирование баз данных</A>).

<LI>

Используйте <code>mysqld --log</code> и попытайтесь определить по информации в
журналах, не вызвано ли прекращение работы сервера каким-либо
специфическим запросом. Около 95% всех ошибок обусловлены конкретными
запросами! Обычно это один из последних запросов в журнальном файле
непосредственно до перезапуска MySQL (see section <A HREF="manual.ru_MySQL_Database_Administration.html#Query_log">4.9.2  Общий журнал запросов</A>). Если вы сумеете повторно вызвать  отказ MySQL при помощи одного
из запросов, даже когда таблицы были проверены непосредственно перед
выполнением запроса, то возможна локализация ошибки и подготовка
отчета об ошибке! see section <A HREF="manual.ru_Introduction.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

<LI>

Попробуйте сделать контрольный тест, который мы могли бы использовать,
чтобы воспроизвести проблему (see section <A HREF="manual.ru_Porting.html#Reproduceable_test_case">E.1.6  Создание контрольного примера при повреждении таблиц</A>).

<LI>

Попробуйте выполнить входящий в поставку тест <code>mysql-test</code> и тесты
производительности MySQL (see section <A HREF="manual.ru_Extending_MySQL.html#MySQL_test_suite">9.1.2  Пакет тестирования MySQL</A>). Эти тесты
должны довольно хорошо протестировать MySQL. Вы можете также добавить
в тесты производительности код для имитации своего приложения! Тесты
производительности можно найти в каталоге bench в поставке с исходными
кодами или, в случае бинарной поставки, в подкаталоге <code>sql-bench</code> своего
каталога инсталляции MySQL.

<LI>

Попробуйте <code>fork_test.pl</code> и <code>fork2_test.pl</code>.

<LI>

Если что-то пойдет не так, то собирать информацию о возможных ошибках
будет значительно проще, если MySQL сконфигурирован для отладки.
Переконфигурируйте MySQL, применяя <code>configure</code> с опцией <code>--with-debug</code> или
<code>--with-debug=full</code>, и затем перекомпилируйте (see section <A HREF="manual.ru_Porting.html#Debugging_server">E.1  Отладка сервера MySQL</A>).

<LI>

Конфигурирование MySQL в отладочном режиме приводит к включению
безопасного распределителя памяти, который может находить некоторые
ошибки. Помимо этого, отладочная версия выдает большое количество
информации о том, что происходит.

<LI>

Выясните, применены ли последние патчи для используемой операционной
системы.

<LI>

Используйте опцию <code>--skip-external-locking</code> к <code>mysqld</code>. На некоторых системах
менеджер блокировок <code>lockd</code> не работает как следует; опция
<code>--skip-external-locking</code> указывает <code>mysqld</code> не применять внешнюю блокировку (это
означает, что нельзя выполнять два сервера <code>mysqld</code> на одних данных и
что необходимо быть осторожным при использовании <code>myisamchk</code>, однако
применение этой опции может принести большую пользу для целей
тестирования).

<LI>

Если возникнет ситуация, когда кажется, что <code>mysqld</code> запущен, но не
отвечает, стоит попробовать выполнить <code>mysqladmin -u root processlist</code>.
Иногда <code>mysqld</code> не является зависшим, даже если кажется, что это так.
Проблема может быть в том, что все соединения используются, или,
возможно, имеется некая внутренняя проблема с блокировками. <code>mysqladmin
processlist</code> обычно способна установить соединение даже в таких случаях
и выдать полезную информацию о текущем количестве соединений и их
состоянии.

<LI>

Выполните команду в отдельном окне <code>mysqladmin -i 5 status</code> или
<code>mysqladmin -i 5 -r</code> для вывода статистики, пока будут выполняться
другие запросы.

<LI>

Попробуйте выполнить следующие действия:


<ol>
<LI>

Запустите <code>mysqld</code> в <code>gdb</code> (или в другом отладчике).
See section <A HREF="manual.ru_Porting.html#Using_gdb_on_mysqld">E.1.3  Отладка mysqld при помощи gdb</A>.

<LI>

Запустите тестовые скрипты.

<LI>

Отобразите стек (<code>backtrace</code>) и локальные переменные на трех нижних
уровнях. В <code>gdb</code> это можно сделать следующими командами после аварийного
завершения <code>mysqld</code> внутри <code>gdb</code>:


<pre>
backtrace
info local
up
info local
up
info local
</pre>

С помощью <code>gdb</code> можно также выяснить, какие имеются потоки (посредством <code>info
threads</code>), и переключиться на определенный поток посредством <code>thread #</code>, где
<code>#</code> - номер потока.
</ol>

<LI>

Попробуйте имитировать работу своего приложения с помощью
Perl-скрипта, который бы вызвал аварийное завершение или неправильное
функционирование MySQL.

<LI>

Отправьте нам обычный отчет об ошибке (see section <A HREF="manual.ru_Introduction.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>). Любые подробности будут нелишними. Поскольку MySQL
нормально эксплуатируется в очень многих местах, то, возможно, авария
вызвана причиной, которая свойственна только вашему компьютеру
(например, ошибка, связанная с вашими особенными системными
библиотеками).

<LI>

Если возникла проблема с таблицами, имеющими динамическую длину строк,
и не используются столбцы типа <code>BLOB/TEXT</code> (а только столбцы типа
<code>VARCHAR</code>), то можно попробовать изменить все <code>VARCHAR</code> на <code>CHAR</code> с помощью
<code>ALTER TABLE</code>. Это заставит MySQL использовать строки фиксированного
размера. Для строк фиксированного размера понадобится немного
дополнительной памяти, однако они гораздо менее чувствительны к
повреждениям! Сегодняшний код динамических строк без  каких бы то ни
было проблем эксплуатируется в MySQL AB по крайней мере 3 года, но в
принципе строки динамической длины более подвержены ошибкам, поэтому
данный рецепт, возможно, сможет вам чем-то помочь!
</ul>



<H3><A NAME="Resetting_permissions" HREF="manual.ru_toc.html#Resetting_permissions">A.4.2  Как переустановить забытый пароль пользователя <code>root</code></A></H3>

<P>
<A NAME="IDX1746"></A>
<A NAME="IDX1747"></A>
<A NAME="IDX1748"></A>

</P>
<P>
Если для MySQL пароль пользователя <code>root</code> никогда не устанавливался, то для
соединения с сервером в качестве пользователя <code>root</code> пароль не потребуется.
Рекомендуется всегда устанавливать пароль для каждого пользователя 
(see section <A HREF="manual.ru_MySQL_Database_Administration.html#Security">4.2.2  Как обезопасить MySQL от хакеров</A>).

</P>
<P>
Если вы забыли установленный для <code>root</code> пароль, то новый пароль можно задать
при помощи следующей процедуры:

</P>

<ol>
<LI>

Остановите сервер <code>mysqld</code>; для этого нужно послать <code>kill</code> (но не <code>kill -9</code>)
серверу <code>mysqld</code>. Номер процесса хранится в файле <tt>`.pid'</tt>, обычно расположенном в каталоге
баз данных MySQL:


<pre>
shell&#62; kill `cat /mysql-data-directory/hostname.pid`
</pre>

Чтобы выполнить  эту команду, необходимо быть либо Unix-пользователем
<code>root</code>, либо пользователем, под которым работает <code>mysqld</code>.

<LI>

Перезапустите <code>mysqld</code> с опцией <code>--skip-grant-tables</code>.

<LI>

Установите новый пароль с помощью команды <code>mysqladmin password</code>:


<pre>
shell&#62; mysqladmin -u root password 'mynewpassword'
</pre>

<LI>

Теперь можно либо просто остановить <code>mysqld</code> и заново запустить его
обычным способом, либо просто загрузить таблицы привилегий посредством:


<pre>
shell&#62; mysqladmin -h hostname flush-privileges
</pre>

<LI>

После этого можно будет соединяться, пользуясь новым паролем.
</ol>

<P>
Есть и другой способ установки нового пароля - с помощью клиента <code>mysql</code>:

</P>

<ol>
Остановите <code>mysqld</code> и перезапустите его с опцией <code>--skip-grant-tables</code>, как
было описано ранее.

<LI>

Соединитесь с сервером <code>mysqld</code> посредством:


<pre>
shell&#62; mysql -u root mysql
</pre>

<LI>

Выполните следующие команды из клиента <code>mysql</code>:


<pre>
mysql&#62; UPDATE user SET Password=PASSWORD('mynewpassword')
    -&#62; WHERE User='root';
mysql&#62; FLUSH PRIVILEGES;
</pre>

<LI>

После этого можно будет соединяться по новому паролю.

<LI>

Остановите <code>mysqld</code> и запустите его заново, как обычно.
</ol>



<H3><A NAME="Full_disk" HREF="manual.ru_toc.html#Full_disk">A.4.3  Как MySQL реагирует на переполнение диска</A></H3>

<P>
<A NAME="IDX1749"></A>
<A NAME="IDX1750"></A>
<A NAME="IDX1751"></A>

</P>

<P>
Когда возникает ситуация переполнения диска, MySQL реагирует следующим
образом:

</P>

<ul>
Один раз в минуту сервер проверяет, достаточно ли места для записи
текущей строки. Если места достаточно, то сервер продолжает работу так,
как будто ничего не произошло.

<LI>

Каждые 6 минут сервер помещает в журнальный файл запись с
предупреждением о ситуации переполнения диска.
</ul>

<P>
Для снижения остроты проблемы можно принять следующие меры:

</P>

<ul>
<LI>

Чтобы продолжать работу, необходимо просто освободить на диске место,
достаточное для вставки всех записей.

<LI>

Чтобы прервать поток, необходимо послать потоку <code>mysqladmin kill</code>. Поток
будет аварийно прекращен, когда он в следующий раз проверит диск (в
течение 1 минуты).

<LI>

Учтите, что таблицу, вызвавшую ситуацию переполнения диска, могут
ожидать другие потоки. Если существует несколько "блокированных" потоков,
то удаление одного потока, ожидающего по причине переполнения диска,
позволит продолжаться другим.
</ul>

<P>
Исключение составляет использование <code>REPAIR</code> или <code>OPTIMIZE</code>, а также случай,
когда индексы создаются в пакете после команды <code>LOAD DATA INFILE</code> или <code>ALTER
TABLE</code>.

</P>
<P>
Все упомянутые команды могут использовать большие временные файлы,
которые, если их оставить без внимания, могут вызвать большие проблемы во
всей системе. Если MySQL сталкивается с переполнением диска при выполнении
одной из указанных операций, то сервер удаляет большие временные файлы и
отмечает таблицу как поврежденную (за исключением <code>ALTER TABLE</code>, для
которого старая таблица остается без изменений).

</P>


<H3><A NAME="Temporary_files" HREF="manual.ru_toc.html#Temporary_files">A.4.4  Где MySQL хранит временные файлы</A></H3>

<P>
Переменная окружения <code>TMPDIR</code> содержит полное имя каталога, в котором в
MySQL хранит временные  файлы. Если <code>TMPDIR</code> не установлена, то MySQL
использует каталог, заданный в системе  по умолчанию (обычно это <tt>`/tmp'</tt> или
<tt>`/usr/tmp'</tt>). Если файловая система, в которой находится каталог временных
файлов, слишком мала, то следует, отредактировав <code>safe_mysqld</code>, присвоить
<code>TMPDIR</code> значение, указывающее на каталог в "более просторной" файловой
системе! Временный каталог можно также задавать с помощью опции <code>--tmpdir</code> к
<code>mysqld</code>.

</P>
<P>
Все временные файлы  MySQL создает как скрытые; таким образом
гарантируется, что временные файлы будут удалены, если <code>mysqld</code> умрет.
Недостаток использования скрытых файлов в том, что не будут видны большие
временные файлы, забирающие место в файловой системе, где расположен
каталог временных файлов.

</P>
<P>
При сортировке (<code>ORDER BY</code> или <code>GROUP BY</code>) MySQL обычно использует один или
два временных файла. Максимальный размер требующегося для этого
пространства  на диске составляет:

</P>

<pre>
(размер сортируемых данных + sizeof(указатель базы данных))
* количество совпавших записей
* 2
</pre>

<P>
<code>sizeof(указатель базы данных)</code> обычно равен 4, но со временем для очень больших
таблиц может увеличиться.

</P>
<P>
Для некоторых запросов <code>SELECT</code> MySQL также создает временные SQL-таблицы.
Они не скрытые и имеют имена вида <tt>`SQL_*'</tt>.

</P>
<P>
<code>ALTER TABLE</code> создает временную таблицу в одном каталоге с исходной
таблицей.

</P>
<P>
Если вы используете версию 4.1 или более новую - вы можете распределять нагрузку
между несколькими физическими дисками путем установления <code>--tmpdir</code> в
список путей, разделенных двоеточием <code>:</code> (точкой с запятой <code>;</code> - под
Winodws). Они будут использоваться в ротации. <strong>Замечание:</strong> эти пути
должны представлять различные <strong>физические</strong> диски, а не различные разделы
одного и того же диска.

</P>



<H3><A NAME="Problems_with_mysql.sock" HREF="manual.ru_toc.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A></H3>

<P>
<A NAME="IDX1752"></A>
<A NAME="IDX1753"></A>

</P>
<P>
Если возникают проблемы с тем, что кто угодно  может удалить
коммуникационный сокет MySQL <tt>`/tmp/mysql.sock'</tt>, то в большинстве версий Unix
можно защитить содержимое <tt>`/tmp'</tt>, установив на каталоге ``липучий'' (sticky)
бит. Войдите в систему как пользователь <code>root</code> и выполните следующую
команду:

</P>

<pre>
shell&#62; chmod +t /tmp
</pre>

<P>
Это защитит ваш каталог <tt>`/tmp'</tt>: теперь удалять в нем файлы смогут только их
владельцы или суперпользователь (<code>root</code>).

</P>
<P>
Проверить, установлен ли ``липучий'' (sticky) бит, можно, выполнив 
<code>ls -ld /tmp</code>. Если последним битом прав является <code>t</code>, то 
бит установлен.

</P>
<P>
Изменить путь к каталогу, где MySQL открывает сокет-файл, можно,
воспользовавшись одним из следующих способов:

</P>

<ul>
<LI>

Укажите путь в глобальном или локальном файле опций. Например, поместите
в <tt>`/etc/my.cnf'</tt>:


<pre>
[client]
socket=path-for-socket-file

[mysqld]
socket=path-for-socket-file
</pre>

See section <A HREF="manual.ru_MySQL_Database_Administration.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

<LI>

Укажите, где расположен файл, в командной строке <code>safe_mysqld</code> и
большинства клиентов с помощью опции <code>--socket=путь-к-файлу-сокета</code>.

<LI>

Укажите путь к сокету в переменной окружения <code>MYSQL_UNIX_PORT</code>.

<LI>

Определите путь с помощью опции конфигурирования
<code>--with-unix-socket-path=путь-к-файлу-сокета</code> (see section <A HREF="manual.ru_Installing.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>).
</ul>

<P>
Проверить, работает ли сокет, можно следующей командой:

</P>

<pre>
shell&#62; mysqladmin --socket=/path/to/socket version
</pre>



<H3><A NAME="Timezone_problems" HREF="manual.ru_toc.html#Timezone_problems">A.4.6  Проблемы с часовыми поясами</A></H3>

<P>
<A NAME="IDX1754"></A>
<A NAME="IDX1755"></A>

</P>
<P>
<A NAME="IDX1756"></A>
<A NAME="IDX1757"></A>

</P>
<P>
Если есть проблема с тем, что <code>SELECT NOW()</code> возвращает значения GMT, а не
местное время, то необходимо установить переменную окружения <code>TZ</code> равной
местному часовому поясу. Это должно быть сделано для окружения, в котором
работает сервер, например, в <code>safe_mysqld</code> или <code>mysql.server</code> (see section <A HREF="manual.ru_Environment_variables.html#Environment_variables">F  Переменные окружения</A>).

</P>


<H2><A NAME="Query_Issues" HREF="manual.ru_toc.html#Query_Issues">A.5  Проблемы, относящиеся к запросам</A></H2>



<H3><A NAME="Case_sensitivity" HREF="manual.ru_toc.html#Case_sensitivity">A.5.1  Чувствительность к регистру при поиске</A></H3>

<P>
<A NAME="IDX1758"></A>
<A NAME="IDX1759"></A>
<A NAME="IDX1760"></A>
<A NAME="IDX1761"></A>

</P>
<P>
По умолчанию поиск в MySQL является независимым от регистра символов (хотя
существуют некоторые кодировки, которые всегда чувствительны к регистру,
такие как <code>czech</code>). Это означает, что при поиске с помощью <code>col_name LIKE
'a%'</code> будут выданы все значения столбца, начинающиеся на A или a. Если
необходимо выполнить тот же поиск с учетом регистра, для проверки префикса
следует использовать что-то вроде <code>INSTR(col_name, "A")=1</code> или
<code>STRCMP(col_name, "A") = 0</code>, если значение в столбце точно равно <code>A</code>.

</P>
<P>
Простые операции сравнения (<code>&#62;=, &#62;, =, &#60;, &#60;=</code>, сортировка и группировка)
основываются на "сорте" каждого символа. Символы одного сорта (такие как
<code>E</code>, <code>e</code> и <code>E</code>) обрабатываются как одинаковые символы!

</P>
<P>
В старых версиях MySQL сравнения по <code>LIKE</code> выполнялись над символами,
переведенными в верхний регистр (<code>E == e</code>, но <code>E &#60;&#62; E</code>). В новых версиях MySQL
<code>LIKE</code> работает точно так же, как другие операторы сравнения.

</P>
<P>
Если необходимо, чтобы столбец всегда обрабатывался в с учетом регистра,
объявите его с типом <code>BINARY</code> (see section <A HREF="manual.ru_Reference.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>).

</P>
<P>
Если вы используете китайские данные в так называемой кодировке <code>big5</code>, то
имеет смысл объявить все символьные столбцы как <code>BINARY</code>. Сортировка таких
столбцов будет работать, поскольку порядок сортировки символов в кодировке
<code>big5</code> основывается на порядке кодов <code>ASCII</code>.

</P>


<H3><A NAME="Using_DATE" HREF="manual.ru_toc.html#Using_DATE">A.5.2  Проблемы с использованием столбцов типа <code>DATE</code></A></H3>

<P>
<A NAME="IDX1762"></A>

</P>
<P>
<A NAME="IDX1763"></A>
<A NAME="IDX1764"></A>

</P>
<P>
Значения типа <code>DATE</code> имеют формат <code>YYYY-MM-DD</code>; согласно стандарту ANSI SQL,
никакой другой формат не допускается. Пользователь должен применять этот
формат в выражениях <code>UPDATE</code> и в определении <code>WHERE</code> операторов <code>SELECT</code>.
Например:

</P>

<pre>
mysql&#62; SELECT * FROM tbl_name WHERE date &#62;= '1997-05-05';
</pre>

<P>
Из соображений удобства MySQL автоматически преобразовывает дату в число,
если дата используется в числовом контексте (и наоборот). Благодаря своей
``разумности'' MySQL допускает также ``мягкую'' строковую форму при обновлении
и в определении <code>WHERE</code>, сравнивающем дату со столбцом типа <code>TIMESTAMP, DATE</code>
или <code>DATETIME</code> ("мягкая" форма означает, что для разделения составляющих
даты можно использовать любой знак пунктуации; например, <code>1998-08-15</code> и
<code>1998#08#15</code> эквивалентны). MySQL может также преобразовывать в даты
строки, не содержащие разделителей (наподобие <code>19980815</code>), при условии,
что представляемая строкой дата не лишена смысла.

</P>
<P>
Специальная дата <code>0000-00-00</code> может записываться и извлекаться в виде
<code>0000-00-00</code>. При использовании даты <code>0000-00-00</code> из <code>MyODBC</code> она будет
автоматически преобразована в <code>NULL</code> в версии <code>MyODBC 2.50.12</code> и выше, так как
<code>ODBC</code> не обеспечивает обработку такого рода дат.

</P>
<P>
Поскольку в MySQL выполняются описанные выше преобразования, следующие
команды будут работать:

</P>

<pre>
mysql&#62; INSERT INTO tbl_name (idate) VALUES (19970505);
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('19970505');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('97-05-05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('1997.05.05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('1997 05 05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('0000-00-00');
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= '1997-05-05';
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= 19970505;
mysql&#62; SELECT MOD(idate,100) FROM tbl_name WHERE idate &#62;= 19970505;
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= '19970505';
</pre>

<P>
Однако приведенные ниже команды работать не будут:

</P>

<pre>
mysql&#62; SELECT idate FROM tbl_name WHERE STRCMP(idate,'19970505')=0;
</pre>

<P>
<code>STRCMP()</code> - строковая функция, следовательно, она преобразует <code>idate</code> в
строку и сравнивает строки. Функция не станет преобразовывать <code>19970505</code> в
дату и сравнивать даты.

</P>
<P>
Заметим, что MySQL осуществляет очень ограниченную проверку правильности дат, поэтому такая
некорректная дата, как <code>1998-2-31</code>, будет занесена в базу. 

</P>
<P>
Поскольку MySQL пакует даты для сохранения, он не может сохранить любую дату,
так как она может не поместится в результирующий буфер. Правила принятия дат
следующие:

</P>

<ul>
<LI>

Если MySQL может хранить и выбирать заданную дату, неправильная дата принимается
для столбцов <code>DATE</code> и <code>DATETIME</code>.
<LI>

Все значения дней между 0-31 принимаются для любой даты, это удобно для
приложения, где вы запрашиваете год, месяц и день в 3х различных полях.
<LI>

День или месяц могут быть нулем. Это удобно когда вы хотите хранить дату
рождения в столбце <code>DATE</code> и знаете только часть ее.
</ul>

<P>
Если же дату нельзя преобразовать в какое-нибудь разумное значение, в поле типа
DATE заносится 0. Проверка правильности дат не делается - в основном из
соображений, связанных со скоростью: мы считаем, что проверкой дат должно
заниматься приложение, а не сервер.

</P>



<H3><A NAME="Problems_with_NULL" HREF="manual.ru_toc.html#Problems_with_NULL">A.5.3  Проблемы со значением <code>NULL</code></A></H3>

<P>
<A NAME="IDX1765"></A>

</P>
<P>
<A NAME="IDX1766"></A>

</P>
<P>
Концепция <code>NULL</code>-значения часто вводит в заблуждение новичков в SQL, которые
считают, что <code>NULL</code> - то же, что и пустая строка <code>""</code>. Это ошибка! Например,
следующие команды совершенно различны:

</P>

<pre>
mysql&#62; INSERT INTO my_table (phone) VALUES (NULL);
mysql&#62; INSERT INTO my_table (phone) VALUES ("");
</pre>

<P>
Обе команды вставляют значение в столбец <code>phone</code>, но первая - значение <code>NULL</code>,
а вторая - пустую строку. Смысл первого можно передать как ``номер телефона
неизвестен'', смысл второго - ``у нее нет телефона''.

</P>
<P>
В SQL сравнение значения <code>NULL</code> с любым другим значением, даже со значением
<code>NULL</code>, всегда ложно. Выражение, содержащее <code>NULL</code>, всегда дает значение <code>NULL</code>,
за исключением случаев, специально оговоренных в документации по
операторам и функциям, присутствующим в выражении. Все столбцы в следующем
примере возвращают <code>NULL</code>:

</P>

<pre>
mysql&#62; SELECT NULL,1+NULL,CONCAT('Invisible',NULL);
</pre>

<P>
Если в столбце нужно найти значения <code>NULL</code>, то нельзя использовать условие
<code>=NULL</code>. Следующая команда не возвращает ни одной строки, поскольку для
любого выражения <code>expr = NULL</code> ЛОЖНО:

</P>

<pre>
mysql&#62; SELECT * FROM my_table WHERE phone = NULL;
</pre>

<P>
Для поиска значений <code>NULL</code> необходимо использовать проверку <code>IS NULL</code>. Ниже
показано, как найти телефонный номер <code>NULL</code> и пустой телефонный номер:

</P>

<pre>
mysql&#62; SELECT * FROM my_table WHERE phone IS NULL;
mysql&#62; SELECT * FROM my_table WHERE phone = "";
</pre>

<P>
Заметим, что добавлять индекс по столбцу, в котором допускаются значения
<code>NULL</code>, можно только в случае, если вы работаете с версией MySQL 3.23.2 или
выше, а используемый тип таблиц - <code>MyISAM</code> или <code>InnoDB</code>. В более ранних
версиях или для других типов таблиц необходимо объявлять такие столбцы с
атрибутом <code>NOT NULL</code>. Это также подразумевает, что тогда нельзя вставлять
<code>NULL</code> в индексированный столбец.

</P>
<P>
<A NAME="IDX1767"></A>
При чтении данных с помощью <code>LOAD DATA INFILE</code> пустые поля обновляются
значениями ''. Если необходимо поместить в столбец <code>значение</code> NULL, то в
текстовом файле следует использовать <code>\N</code>. Также при некоторых
обстоятельствах можно использовать слово-литерал <code>NULL</code> (see section <A HREF="manual.ru_Reference.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>).

</P>
<P>
При использовании <code>ORDER BY</code> значения <code>NULL</code> выдаются первыми.
В версиях предшествующих 4.0.2, при сортировке в убывающем порядке при помощи
<code>DESC</code>, значения <code>NULL</code> также выдаются последними.
При использовании <code>GROUP BY</code> все значения <code>NULL</code> считаются равными.

</P>
<P>
Для обработки <code>NULL</code> предназначены операторы <code>IS NULL</code> и <code>IS NOT NULL</code>, а также
функция <code>IFNULL()</code>.

</P>
<P>
<A NAME="IDX1768"></A>
<A NAME="IDX1769"></A>
<A NAME="IDX1770"></A>
<A NAME="IDX1771"></A>
Для некоторых типов столбцов значения <code>NULL</code> обрабатываются специальным
образом. Если <code>NULL</code> вставляется в первый в таблице столбец типа <code>TIMESTAMP</code>,
то в него помещается значение текущей даты и времени. При вставке <code>NULL</code> в
<code>AUTO_INCREMENT</code>-столбец вставляется следующее число последовательности.

</P>


<H3><A NAME="Problems_with_alias" HREF="manual.ru_toc.html#Problems_with_alias">A.5.4  Проблемы  с <code>alias</code></A></H3>

<P>
<A NAME="IDX1772"></A>

</P>
<P>
Псевдонимы можно использовать для ссылки на столбец в <code>GROUP BY, ORDER BY</code>
или в части <code>HAVING</code>, а также для лучшего именования столбцов:

</P>

<pre>
SELECT SQRT(a*b) as rt FROM table_name GROUP BY rt HAVING rt &#62; 0;
SELECT id,COUNT(*) AS cnt FROM table_name GROUP BY id HAVING cnt &#62; 0;
SELECT id AS "Customer identity" FROM table_name;
</pre>

<P>
Заметим, что в ANSI SQL запрещено ссылаться на псевдоним в определении
<code>WHERE</code>. Вызвано это тем, что при выполнении кода <code>WHERE</code> значение столбца
может быть еще не определенным. Например, следующий запрос <strong>недопустим</strong>:

</P>

<pre>
SELECT id,COUNT(*) AS cnt FROM table_name WHERE cnt &#62; 0 GROUP BY id;
</pre>

<P>
Выражение <code>WHERE</code> выполняется, чтобы определить, какие строки следует
включить в часть <code>GROUP BY</code>, тогда как <code>HAVING</code> используется для тех строк из
результирующего множества, которые должны использоваться.

</P>


<H3><A NAME="Deleting_from_related_tables" HREF="manual.ru_toc.html#Deleting_from_related_tables">A.5.5  Удаление строк из взаимосвязанных таблиц</A></H3>

<P>
<A NAME="IDX1773"></A>
<A NAME="IDX1774"></A>
<A NAME="IDX1775"></A>

</P>
<P>
Поскольку MySQL до 4.1.0 не поддерживает вложенных запросов, а также
использование более одной таблицы в команде <code>DELETE</code> (до версии 4.0), то
для удаления строк из 2 взаимосвязанных таблиц следует использовать следующий
подход:

</P>

<ol>
<LI>

Выполните в главной таблице <code>SELECT</code> строк на основе некоторого условия
<code>WHERE</code>.

<LI>

Выполните <code>DELETE</code> строк главной таблицы на основе этого же условия.

<LI>

<code>DELETE FROM related_table WHERE related_column IN (selected_rows)</code>.
</ol>

<P>
где <code>selected_rows</code> - количество строк, выбранных по запросу в п.1.

</P>
<P>
Если общее количество символов в запросе с <code>related_column</code> больше 1048576
(значение <code>max_allowed_packet</code> по умолчанию), то следует разбить запрос на
меньшие части и выполнить несколько команд <code>DELETE</code>. Если <code>related_column</code>
является индексом/индексирован, то самый быстрый <code>DELETE</code> получится при
удалении 100-1000 идентификаторов <code>related_column</code> за запрос. Если
<code>related_column</code> не индекс, то скорость не зависит  от количества аргументов
в операторе <code>IN</code>.

</P>


<H3><A NAME="No_matching_rows" HREF="manual.ru_toc.html#No_matching_rows">A.5.6  Решение проблем с отсутствием строк, удовлетворяющих условиям поиска</A></H3>

<P>
<A NAME="IDX1776"></A>
<A NAME="IDX1777"></A>

</P>
<P>
Если сложный запрос на множестве таблиц совсем не возвращает строк, то для
выяснения причин его неуспешного выполнения необходимо выполнить следующую
последовательность действий:

</P>

<ol>
<LI>

Проверьте запрос с помощью <code>EXPLAIN</code> и посмотрите, не присутствуют ли в
нем явно неправильные записи (see section <A HREF="manual.ru_MySQL_Optimisation.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>).

<LI>

Выберите только поля, используемые в выражении <code>WHERE</code>.

<LI>

По одной убирайте из запроса таблицы до тех пор, пока не станут
возвращаться какие-нибудь строки. Если таблицы большие, то в запросе имеет
смысл использовать <code>LIMIT 10</code>.

<LI>

Выполните <code>SELECT</code> для столбца, который должен был дать совпадение строки
с последней исключенной из запроса таблицей.

<LI>

Если столбцы типа <code>FLOAT</code> или <code>DOUBLE</code> сравниваются с имеющими дробную
часть числами, то нельзя использовать <samp>`='</samp>. Это распространенная проблема в
большинстве компьютерных языков, поскольку значения с плавающей запятой не
являются точными. В большинстве случаев проблему решает изменение <code>FLOAT</code> на
<code>DOUBLE</code>. See section <A HREF="manual.ru_Problems.html#Problems_with_float">A.5.7  Проблемы со сравнением чисел с плавающей точкой</A>.

<LI>

Если так и не удалось выяснить, в чем загвоздка, то для демонстрации
возникших у вас проблем создайте минимальный тест, запускающийся при
помощи <code>mysql test &#60; query.sql</code>. Тестовый файл можно создать,
воспользовавшись <code>mysqldump --quick database tables &#62; query.sql</code>. Далее
откройте файл в редакторе, удалите некоторые команды вставки (если их
слишком много) и добавьте в конце файла свою команду выборки. Убедитесь,
что проблема по-прежнему проявляется, посредством:


<pre>
shell&#62; mysqladmin create test2
shell&#62; mysql test2 &#60; query.sql
</pre>

Используя <code>mysqlbug</code>, пошлите тестовый файл в список рассылки на <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>.
</ol>



<H3><A NAME="Problems_with_float" HREF="manual.ru_toc.html#Problems_with_float">A.5.7  Проблемы со сравнением чисел с плавающей точкой</A></H3>

<P>
Числа с плавающей точкой иногда служат источником неприятностей, поскольку
эти числа архитектурно хранятся в компьютере не как точные числа. То, что
обычно мы видим на экране, не является точным значением числа.

</P>
<P>
Поля типов FLOAT, DOUBLE и DECIMAL следующие.

</P>

<pre>
CREATE TABLE t1 (i INT, d1 DECIMAL(9,2), d2 DECIMAL(9,2));
INSERT INTO t1 VALUES (1, 101.40, 21.40), (1, -80.00, 0.00),
(2, 0.00, 0.00), (2, -13.20, 0.00), (2, 59.60, 46.40),
(2, 30.40, 30.40), (3, 37.00, 7.40), (3, -29.60, 0.00),
(4, 60.00, 15.40), (4, -10.60, 0.00), (4, -34.00, 0.00),
(5, 33.00, 0.00), (5, -25.80, 0.00), (5, 0.00, 7.20),
(6, 0.00, 0.00), (6, -51.40, 0.00);

mysql&#62; SELECT i, SUM(d1) AS a, SUM(d2) AS b
    -&#62; FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
</pre>

<P>
Результат правильный. Хотя кажется, что первые пять записей должны быть
отброшены, не выдержав проверки на сравнение, тем не менее, они могут
удовлетворить условиям по той причине, что в зависимости от архитектуры
компьютера между числами проявляются отличия примерно на уровне десятого
знака.

</P>
<P>
С помощью <code>ROUND()</code> (или подобной функции) проблема не может быть решена,
поскольку результат все равно будет числом с плавающей запятой, например:

</P>

<pre>
mysql&#62; SELECT i, ROUND(SUM(d1), 2) AS a, ROUND(SUM(d2), 2) AS b
    -&#62; FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
</pre>

<P>
Вот как выглядят числа в столбце 'a':

</P>

<pre>
mysql&#62; SELECT i, ROUND(SUM(d1), 2)*1.0000000000000000 AS a,
    -&#62; ROUND(SUM(d2), 2) AS b FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+----------------------+-------+
| i    | a                    | b     |
+------+----------------------+-------+
|    1 |  21.3999999999999986 | 21.40 |
|    2 |  76.7999999999999972 | 76.80 |
|    3 |   7.4000000000000004 |  7.40 |
|    4 |  15.4000000000000004 | 15.40 |
|    5 |   7.2000000000000002 |  7.20 |
|    6 | -51.3999999999999986 |  0.00 |
+------+----------------------+-------+
</pre>

<P>
В вашей системе результаты могут либо такими, либо нет - это зависит от
архитектуры компьютера. Каждый процессор выполняет вычисления с плавающей
точкой по-своему. Например, на некоторых машинах можно получить
``правильные'' результаты, если умножить оба аргумента на 1 (см. пример
ниже).

</P>
<P>
<strong>ПРЕДУПРЕЖДЕНИЕ: НИКОГДА НЕ ПОЛАГАЙТЕСЬ НА ДАННЫЙ МЕТОД В СВОЕМ ПРИЛОЖЕНИИ,
ЭТО ПРИМЕР ТОГО, КАКИЕ МЕТОДЫ НЕ СЛЕДУЕТ ИСПОЛЬЗОВАТЬ!!!</strong>

</P>

<pre>
mysql&#62; SELECT i, ROUND(SUM(d1), 2)*1 AS a, ROUND(SUM(d2), 2)*1 AS b
    -&#62; FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
</pre>

<P>
Приведенный выше пример вроде бы работает. Но это случайность, поскольку
именно на той конкретной машине, где выполнялась проверка, процессор
выполняет арифметические операции с плавающей точкой таким образом, что
числа округляются до одинаковых значений. Однако полагаться на то, что так
будут работать все без исключения процессоры, нельзя.

</P>
<P>
Правильный способ сравнения чисел с плавающей запятой заключается в том,
чтобы сначала определиться с допустимым отклонением одного числа от
другого, а затем при сравнении учитывать этот допуск. Например, если мы
договоримся, что числа должны считаться одинаковыми, если они равны с
точностью до одной десятитысячной (0,0001), то сравнение должно
проводиться следующим образом:

</P>

<pre>
mysql&#62; SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -&#62; GROUP BY i HAVING ABS(a - b) &#62; 0.0001;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
1 row in set (0.00 sec)
</pre>

<P>
И наоборот, если мы хотим оставить строки, в которых числа одинаковы, то
проверка должна быть следующей:

</P>

<pre>
mysql&#62; SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -&#62; GROUP BY i HAVING ABS(a - b) &#60; 0.0001;
+------+-------+-------+
| i    | a     | b     |
+------+-------+-------+
|    1 | 21.40 | 21.40 |
|    2 | 76.80 | 76.80 |
|    3 |  7.40 |  7.40 |
|    4 | 15.40 | 15.40 |
|    5 |  7.20 |  7.20 |
+------+-------+-------+
</pre>



<H2><A NAME="Table_Definition_Issues" HREF="manual.ru_toc.html#Table_Definition_Issues">A.6  Вопросы, связанные с определением таблиц</A></H2>



<H3><A NAME="ALTER_TABLE_problems" HREF="manual.ru_toc.html#ALTER_TABLE_problems">A.6.1  Проблемы с <code>ALTER TABLE</code></A></H3>

<P>
<A NAME="IDX1778"></A>
<A NAME="IDX1779"></A>
<A NAME="IDX1780"></A>

</P>
<P>
<code>ALTER TABLE</code> изменяет таблицу в соответствии с текущей кодировкой. Если при
выполнении <code>ALTER TABLE</code> выдается ошибка дублирующегося ключа, то причина
либо в том, что новая кодировка отображает ключи в одинаковые значения,
либо в том, что таблица повреждена. В последнем случае на таблице
необходимо выполнить <code>REPAIR TABLE</code>.

</P>
<P>
Если работа <code>ALTER TABLE</code> прекращается с ошибкой, подобной приведенной ниже:

</P>
<P>
<code>Error on rename of './database/name.frm' to './database/B-a.frm' (Errcode:
17)</code>

</P>
<P>
то проблема может быть связана с тем, что MySQL аварийно завершился на
предыдущей команде <code>ALTER TABLE</code> и осталась старая таблица с именем
<tt>`A-что_нибудь'</tt> или <tt>`B-что_нибудь'</tt>. В этом случае перейдите в каталог
данных MySQL и удалите все файлы, имена которых начинаются с <code>A-</code> или <code>B-</code> (их
можно и не удалять, а куда-либо переместить).

</P>
<P>
<code>ALTER TABLE</code> работает следующим образом:

</P>

<ul>
<LI>

Создается новая таблица с именем <tt>`A-xxx'</tt> с заданными в запросе
изменениями.

<LI>

Все строки старой таблицы копируются в <tt>`A-xxx'</tt>.

<LI>

Старая таблица переименовывается в <tt>`B-xxx'</tt>.

<LI>

<tt>`A-xxx'</tt> переименовывается в имя старой таблицы.

<LI>

Удаляется <tt>`B-xxx'</tt>.
</ul>

<P>
Если что-то приключится при операции переименования, MySQL попытается
отменить изменения. Если случится что-то серьезное (чего произойти,
конечно, не должно), MySQL может оставить старую таблицу именованной как
<tt>`B-xxx'</tt> - в этом случае, однако, для восстановления данных достаточно будет
просто переименовать ее на системном уровне.

</P>


<H3><A NAME="Change_column_order" HREF="manual.ru_toc.html#Change_column_order">A.6.2  Как изменить порядок столбцов в таблице</A></H3>

<P>
<A NAME="IDX1781"></A>
<A NAME="IDX1782"></A>
<A NAME="IDX1783"></A>
<A NAME="IDX1784"></A>

</P>
<P>
Основная идея SQL заключается в том, чтобы разделить приложения и формат
хранения данных. Всегда следует указывать порядок извлечения данных,
например:

</P>

<pre>
SELECT col_name1, col_name2, col_name3 FROM tbl_name;
</pre>

<P>
возвратит столбцы в порядке <code>col_name1, col_name2, col_name3</code>, тогда как:

</P>

<pre>
SELECT col_name1, col_name3, col_name2 FROM tbl_name;
</pre>

<P>
возвратит столбцы в порядке <code>col_name1, col_name3, col_name2</code>.

</P>
<P>
В приложения <strong>никогда</strong> нельзя использовать <code>SELECT *</code> и извлекать столбцы,
полагаясь на их позиции, поскольку порядок, в котором возвращаются
столбцы, <strong>не может быть гарантирован</strong>. Простое
изменение в базе данных может катастрофически сказаться на поведении
приложения.

</P>
<P>
Если порядок столбцов все-таки требуется изменить, то сделать это можно
следующим образом:

</P>

<ol>
<LI>

Создайте новую таблицу со столбцами в правильном порядке.

<LI>

Выполните <code>INSERT INTO new_table SELECT поля-в-желаемом-порядке FROM
old_table</code>.

<LI>

Удалите или переименуйте <code>old_table</code>.

<LI>

<code>ALTER TABLE new_table RENAME old_table</code>.
</ol>



<H3><A NAME="Temporary_table_problems" HREF="manual.ru_toc.html#Temporary_table_problems">A.6.3  Проблемы, относящиеся к временным (<code>TEMPORARY</code>) таблицам</A></H3>

<P>
<A NAME="IDX1785"></A>

</P>
<P>
Ниже перечислены ограничения, относящиеся к временным таблицам.

</P>

<ul>
<LI>

Временной может быть только таблица типа <code>HEAP</code>, <code>ISAM</code>, <code>MyISAM</code>, <code>MERGE</code> или <code>InnoDB</code>.

<LI>

Временная таблица не может использоваться в одном запросе более одного
раза. Например, следующий запрос работать не будет.


<pre>
mysql&#62; SELECT * FROM temporary_table, temporary_table AS t2;
</pre>

<LI>

Нельзя использовать <code>RENAME</code> на таблице с атрибутом <code>TEMPORARY</code>. Отметим,
однако, что <code>ALTER TABLE оригинальное_имя RENAME новое_имя</code> работает!
</ul>

<P><HR><P>
Go to the <A HREF="manual.ru_Introduction.html">first</A>, <A HREF="manual.ru_Extending_MySQL.html">previous</A>, <A HREF="manual.ru_Contrib.html">next</A>, <A HREF="manual.ru_Concept_Index.html">last</A> section, <A HREF="manual.ru_toc.html">table of contents</A>.
 </BODY>
 </HTML>
